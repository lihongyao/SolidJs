@ https://docs.solidjs.com/solid-start/

# æ¦‚è¿°

SolidStart æ˜¯ä¸€ä¸ªå¼€æºçš„å…ƒæ¡†æ¶ï¼ˆmeta-frameworkï¼‰ï¼Œæ—¨åœ¨ç»Ÿä¸€æ„å»º Web åº”ç”¨çš„ç»„ä»¶ã€‚å®ƒåŸºäº Solid æ„å»ºï¼Œå¹¶ä½¿ç”¨ Vinxiï¼ˆä¸€ä¸ªä¸­ç«‹çš„æ¡†æ¶æ‰“åŒ…å™¨ï¼ˆFramework Bundlerï¼‰ï¼Œç»“åˆäº† Vite å’Œ Nitro çš„å¼ºå¤§åŠŸèƒ½ï¼‰ã€‚

SolidStart é¿å…è¿‡åº¦è§„å®šå¼€å‘æ–¹å¼ï¼Œä»…æä¾›æœ€å°‘çš„å¯åŠ¨ç»„ä»¶ã€‚è™½ç„¶æä¾›äº†åŒ…å«å¸¸ç”¨å·¥å…·çš„æ¨¡æ¿ï¼Œä½† SolidStart æœ¬èº«å¹¶ä¸å†…ç½®è·¯ç”±å™¨æˆ–å…ƒæ•°æ®åº“ï¼ˆMetadata libraryï¼‰ï¼Œä½ å¯ä»¥è‡ªç”±é€‰æ‹©ä½¿ç”¨ä»»ä½•åº“ã€‚

SolidStart å…è®¸æ ¹æ®ä¸åŒçš„ä½¿ç”¨åœºæ™¯ä»¥å¤šç§æ–¹å¼æ¸²æŸ“åº”ç”¨ï¼ŒåŒ…æ‹¬ï¼š

- å®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰
- æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰
- é™æ€ç«™ç‚¹ç”Ÿæˆï¼ˆSSGï¼‰

SolidStart çš„æ ¸å¿ƒåŸåˆ™ä¹‹ä¸€æ˜¯ä»£ç åº”ä¿æŒ **åŒæ„ï¼ˆisomorphicï¼‰**â€”â€”ç¡®ä¿ä»£ç åªéœ€ç¼–å†™ä¸€æ¬¡ï¼Œæ— è®ºåœ¨å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯éƒ½èƒ½æ­£ç¡®æ‰§è¡Œã€‚

## ç‰¹æ€§

SolidStart å…·å¤‡ä»¥ä¸‹åŠŸèƒ½ï¼š

- ç»†ç²’åº¦å“åº”æ€§ï¼ˆFine-grained reactivityï¼‰

  ç”± Solid æä¾›æ”¯æŒï¼Œå®ç°é«˜æ€§èƒ½ã€å“åº”å¼çš„æ•°æ®æ›´æ–°ã€‚

- åŒæ„åµŒå¥—è·¯ç”±ï¼ˆIsomorphic, nested routingï¼‰

  æ— è®ºé¡µé¢åœ¨å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯ï¼Œç›¸åŒçš„è·¯ç”±éƒ½ä¼šè¢«æ¸²æŸ“ã€‚åµŒå¥—è·¯ç”±æä¾›çˆ¶å­å…³ç³»ï¼Œç®€åŒ–åº”ç”¨é€»è¾‘ã€‚

- å¤šç§æ¸²æŸ“æ¨¡å¼ï¼ˆMultiple rendering modesï¼‰

  å¯ç”¨äºåˆ›å»º CSRã€SSRï¼ˆåŒæ­¥ã€å¼‚æ­¥å’Œæµå¼ï¼‰ä»¥åŠ SSG åº”ç”¨ã€‚

- å‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰å’Œæ¨¡æ¿ï¼ˆTemplatesï¼‰

  æä¾› CLI å’Œæ¨¡æ¿ï¼Œå¸®åŠ©å¿«é€Ÿå¯åŠ¨é¡¹ç›®ã€‚

- éƒ¨ç½²é¢„è®¾ï¼ˆDeployment presetsï¼‰

  æä¾›å¤šå¹³å°éƒ¨ç½²é¢„è®¾ï¼ŒåŒ…æ‹¬ Netlifyã€Vercelã€AWS å’Œ Cloudflareã€‚

### å‰ç½®æ¡ä»¶

åœ¨å¼€å§‹ä½¿ç”¨ SolidStart ä¹‹å‰ï¼Œä½ åº”å…·å¤‡åŸºæœ¬çš„ Web å¼€å‘çŸ¥è¯†ï¼ŒåŒ…æ‹¬ HTMLã€CSS å’Œ JavaScriptã€‚

ç”±äº SolidStart æ˜¯åŸºäº Solid çš„å…ƒæ¡†æ¶ï¼ˆmeta-frameworkï¼‰ï¼Œæˆ‘ä»¬å»ºè®®åœ¨é˜…è¯»æ–‡æ¡£ä¹‹å‰å…ˆå­¦ä¹  Solidï¼Œè‡³å°‘å®Œæˆ Solid çš„å®˜æ–¹æ•™ç¨‹ã€‚

# å¿«é€Ÿä¸Šæ‰‹

å¼€å§‹ä½¿ç”¨ Solid çš„æœ€ç®€å•æ–¹å¼æ˜¯ä½¿ç”¨ SolidStart Starterã€‚è¯¥ Starter æä¾›äº†ä¸€ç³»åˆ—æ¨¡æ¿ï¼Œå¯ç”¨äºå¿«é€Ÿå¯åŠ¨ä¸€ä¸ªæ–°çš„ Solid åº”ç”¨ã€‚

1ï¼‰å®‰è£… SolidStart

è¦å¼€å§‹ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ– SolidStartï¼š

```shell
$ pnpm create solid@latest
â”Œ  
 Create-Solid v0.6.11
â”‚
â—‡  Project Name
â”‚  solidstart-app
â”‚
â—‡  What type of project would you like to create?
â”‚  SolidStart
â”‚
â—‡  Use Typescript?
â”‚  Yes
â”‚
â—‡  Which template would you like to use?
â”‚  basic
â”‚
â—’  Creating project.
â”‚
â—‡  Project created ğŸ‰
â”‚
â—‡  To get started, run: â”€â•®
â”‚                        â”‚
â”‚  cd solidstart-app     â”‚
â”‚  pnpm install          â”‚
â”‚  pnpm dev              â”‚
â”‚                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

è¯¥å‘½ä»¤ä¼šæ ¹æ®ä½ è¾“å…¥çš„åç§°ä¸ºé¡¹ç›®åˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•ã€‚

2ï¼‰å®‰è£…ä¾èµ–

åœ¨é€‰æ‹©å¥½æ¨¡æ¿å’Œé…ç½®é€‰é¡¹åï¼Œè¿›å…¥ä½ åˆ›å»ºçš„é¡¹ç›®ç›®å½•ï¼Œå¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…ä¾èµ–ï¼š

```shell
$ pnpm i
```

å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œä½ çš„æ–° SolidStart åº”ç”¨å°±å·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹å¼€å‘äº†ï¼

3ï¼‰å¯åŠ¨é¡¹ç›®

è¦åœ¨æœ¬åœ°è¿è¡Œä½ çš„åº”ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```shell
$ pnpm dev
```

ç°åœ¨ä½ çš„åº”ç”¨åº”è¯¥å·²ç»åœ¨æœ¬åœ°çš„ 3000 ç«¯å£è¿è¡Œã€‚ä½ å¯ä»¥é€šè¿‡è®¿é—® http://localhost:3000 æ¥æŸ¥çœ‹å®ƒã€‚

> æ³¨æ„ï¼š
>
> SolidStart ä½¿ç”¨ Vinxi æ¥å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆåŸºäº Viteï¼‰ä»¥åŠæ„å»ºå¹¶å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨ï¼ˆåŸºäº Nitroï¼‰ã€‚
>
> å½“ä½ è¿è¡Œåº”ç”¨æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨åå°æ‰§è¡Œ vinxi devã€‚
>
> ä½ å¯ä»¥åœ¨ [Vinxi æ–‡æ¡£](https://vinxi.dev/) ä¸­äº†è§£æ›´å¤šå…³äº Vinxi CLI åŠå…¶é…ç½®çš„å†…å®¹ã€‚

## é¡¹ç›®æ–‡ä»¶

SolidStart ä¼šä¸ºä½ çš„é¡¹ç›®åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œå¹¶ç”Ÿæˆå¿…è¦çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æ¥å¸®åŠ©ä½ å¿«é€Ÿå¼€å§‹å¼€å‘ã€‚è¿™äº›æ–‡ä»¶å’Œç›®å½•æ„æˆäº† SolidStart åº”ç”¨çš„åŸºæœ¬ç»“æ„ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚

é»˜è®¤çš„ SolidStart é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

```
public/
src/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ index.tsx
â”œâ”€â”€ entry-client.tsx
â”œâ”€â”€ entry-server.tsx
â”œâ”€â”€ app.tsx
```

**æ³¨æ„**ï¼šæ ¹æ®ä½ åœ¨åˆ›å»ºé¡¹ç›®æ—¶é€‰æ‹©çš„é…ç½®é€‰é¡¹ï¼Œæ–‡ä»¶ç»“æ„å¯èƒ½ä¼šç•¥æœ‰ä¸åŒã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ é€‰æ‹©ä½¿ç”¨ JavaScript è€Œé TypeScriptï¼Œæ–‡ä»¶æ‰©å±•åå°†æ˜¯ .jsx è€Œä¸æ˜¯ .tsxã€‚

åœ¨è¿™ä¸ªç»“æ„ä¸­ï¼Œæ¯ä¸ªç›®å½•å’Œæ–‡ä»¶åœ¨ SolidStart åº”ç”¨ä¸­éƒ½æœ‰ç‰¹å®šç”¨é€”ï¼š

- **public/** - å­˜æ”¾åº”ç”¨çš„å…¬å…±èµ„æºï¼ŒåŒ…æ‹¬å›¾ç‰‡ã€å­—ä½“ä»¥åŠå…¶ä»–å¸Œæœ›å…¬å¼€è®¿é—®çš„æ–‡ä»¶ã€‚
- **src/** - å­˜æ”¾ä½ çš„ SolidStart åº”ç”¨ä»£ç ã€‚åœ¨ä»£ç ä¸­å¯ä»¥é€šè¿‡åˆ«å ~/ è¿›è¡Œå¯¼å…¥ã€‚
- **src/routes/** - å­˜æ”¾é¡µé¢æ–‡ä»¶æˆ–è·¯ç”±æ–‡ä»¶ã€‚å…³äº routes æ–‡ä»¶å¤¹çš„æ›´å¤šä¿¡æ¯å¯ä»¥å‚è€ƒè·¯ç”±éƒ¨åˆ†ã€‚
- **src/entry-client.tsx** - è´Ÿè´£åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰åŠ è½½å’Œæ°´åˆï¼ˆhydrateï¼‰åº”ç”¨çš„ JavaScriptã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ æ— éœ€ä¿®æ”¹æ­¤æ–‡ä»¶ã€‚
- **src/entry-server.tsx** - å¤„ç†æœåŠ¡å™¨ç«¯çš„è¯·æ±‚ã€‚ä¸ entry-client.tsx ç±»ä¼¼ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æ— éœ€ä¿®æ”¹ã€‚
- **app.tsx** - åº”ç”¨çš„ HTML æ ¹æ–‡ä»¶ï¼Œé€‚ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ¸²æŸ“ã€‚å¯ä»¥å°†å…¶è§†ä¸ºåº”ç”¨æ¸²æŸ“çš„å¤–å£³ï¼ˆshellï¼‰ã€‚

# æ„å»ºåº”ç”¨

## è·¯ç”±

è·¯ç”±æ˜¯ Web åº”ç”¨çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚åœ¨ SolidStart ä¸­ï¼Œè·¯ç”±ä¸»è¦æœ‰ä¸¤ç§ç±»å‹ï¼š

- **UI è·¯ç”±ï¼ˆUI routesï¼‰** â€” å®šä¹‰åº”ç”¨ä¸­çš„ç”¨æˆ·ç•Œé¢ã€‚
- **API è·¯ç”±ï¼ˆAPI routesï¼‰** â€” å®šä¹‰åº”ç”¨ä¸­çš„æ— æœåŠ¡å™¨å‡½æ•°ï¼ˆserverless functionsï¼‰ã€‚

### åˆ›å»ºæ–°è·¯ç”±

SolidStart ä½¿ç”¨ **åŸºäºæ–‡ä»¶çš„è·¯ç”±ï¼ˆfile-based routingï¼‰**ï¼Œå³é€šè¿‡åœ¨é¡¹ç›®ä¸­åˆ›å»ºæ–‡ä»¶å’Œæ–‡ä»¶å¤¹æ¥å®šä¹‰è·¯ç”±ï¼ŒåŒ…æ‹¬é¡µé¢å’Œ API è·¯ç”±ã€‚

SolidStart ä¼šéå† routes ç›®å½•ï¼Œæ”¶é›†æ‰€æœ‰è·¯ç”±ï¼Œå¹¶é€šè¿‡ \<FileRoutes /> ç»„ä»¶å°†å…¶æš´éœ²å‡ºæ¥ã€‚è¯¥ç»„ä»¶ä»…åŒ…å« **UI è·¯ç”±**ï¼Œä¸åŒ…æ‹¬ API è·¯ç”±ã€‚

ä¸å…¶åœ¨ \<Router> ç»„ä»¶ä¸­æ‰‹åŠ¨å®šä¹‰æ¯ä¸ª \<Route>ï¼Œ\<FileRoutes /> ä¼šæ ¹æ®æ–‡ä»¶ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆè·¯ç”±ã€‚

ç”±äº \<FileRoutes /> è¿”å›ä¸€ä¸ªè·¯ç”±é…ç½®å¯¹è±¡ï¼Œä½ å¯ä»¥å°†å®ƒä¸ä»»æ„è·¯ç”±å™¨ä¸€èµ·ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ solid-routerï¼š

```tsx
mport { Suspense } from "solid-js";
import { Router } from "@solidjs/router";
import { FileRoutes } from "@solidjs/start/router";

export default function App() {
  return (
    <Router root={(props) => <Suspense>{props.children}</Suspense>}>
      <FileRoutes />
    </Router>
  );
}
```

\<Router /> ç»„ä»¶éœ€è¦ä¸€ä¸ª root å±æ€§ï¼Œä½œä¸ºæ•´ä¸ªåº”ç”¨çš„æ ¹å¸ƒå±€ã€‚ä½ éœ€è¦ç¡®ä¿ props.children è¢« \<Suspense /> åŒ…è£¹ï¼Œå› ä¸ºæ¯ä¸ªç»„ä»¶ä¼šè¢«è‡ªåŠ¨æ‡’åŠ è½½ã€‚å¦åˆ™ï¼Œå¯èƒ½ä¼šå‡ºç°æ„å¤–çš„æ°´åˆï¼ˆhydrationï¼‰é”™è¯¯ã€‚

\<FileRoutes /> ä¼šä¸º routes ç›®å½•åŠå…¶å­ç›®å½•ä¸­çš„æ¯ä¸ªæ–‡ä»¶ç”Ÿæˆä¸€ä¸ªè·¯ç”±ã€‚è¦å°†æŸä¸ªè·¯ç”±æ¸²æŸ“ä¸ºé¡µé¢ï¼Œè¯¥æ–‡ä»¶å¿…é¡»é»˜è®¤å¯¼å‡ºä¸€ä¸ªç»„ä»¶ã€‚è¿™ä¸ªç»„ä»¶è¡¨ç¤ºç”¨æˆ·è®¿é—®è¯¥é¡µé¢æ—¶è¦æ¸²æŸ“çš„å†…å®¹ã€‚

```tsx
export default function Index() {
  return <div>Welcome to my site!</div>;
}
```

è¿™æ„å‘³ç€ï¼Œä½ åªéœ€åœ¨ routes æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼ŒSolidStart ä¼šè‡ªåŠ¨å¤„ç†ä½¿è¯¥è·¯ç”±åœ¨åº”ç”¨ä¸­å¯è®¿é—®çš„æ‰€æœ‰ç»†èŠ‚ï¼

### åŸºäºæ–‡ä»¶çš„è·¯ç”±

routes ç›®å½•ä¸­çš„æ¯ä¸ªæ–‡ä»¶éƒ½è¢«è§†ä¸ºä¸€ä¸ªè·¯ç”±ã€‚è¦åœ¨åº”ç”¨ä¸­åˆ›å»ºæ–°è·¯ç”±æˆ–é¡µé¢ï¼Œåªéœ€åœ¨ routes ç›®å½•ä¸­åˆ›å»ºæ–°æ–‡ä»¶å³å¯ã€‚æ–‡ä»¶åå°†å¯¹åº”è·¯ç”±çš„ URL è·¯å¾„ï¼Œä¾‹å¦‚ï¼š

- example.com/blog âœ /routes/blog.tsx
- example.com/contact âœ /routes/contact.tsx
- example.com/directions âœ /routes/directions.tsx

#### åµŒå¥—è·¯ç”±

å¦‚æœéœ€è¦åµŒå¥—è·¯ç”±ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªä»¥å‰ç½®è·¯ç”±æ®µå‘½åçš„ç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸­åˆ›å»ºæ–°æ–‡ä»¶ï¼š

- example.com/blog/article-1 âœ /routes/blog/article-1.tsx
- example.com/work/job-1 âœ /routes/work/job-1.tsx

å½“æ–‡ä»¶åä¸º index æ—¶ï¼Œå¦‚æœè¯·æ±‚çš„ URL æ²¡æœ‰é¢å¤–çš„è·¯ç”±æ®µï¼Œå®ƒå°†è¢«æ¸²æŸ“ï¼š

- example.com âœ /routes/index.tsx
- example.com/socials âœ /routes/socials/index.tsx

#### åµŒå¥—å¸ƒå±€

å¦‚æœä½ æƒ³åˆ›å»ºåµŒå¥—å¸ƒå±€ï¼Œå¯ä»¥åœ¨è·¯ç”±æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªä¸æ–‡ä»¶å¤¹åŒåçš„æ–‡ä»¶ã€‚

```tsx
|-- routes/
    |-- blog.tsx                   // layout file
    |-- blog/
        |-- article-1.tsx         // example.com/blog/article-1
        |-- article-2.tsx        // example.com/blog/article-2
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œblog.tsx æ–‡ä»¶å°†ä½œä¸º blog æ–‡ä»¶å¤¹ä¸­æ–‡ç« çš„å¸ƒå±€ã€‚åœ¨å¸ƒå±€ä¸­å¯ä»¥é€šè¿‡ props.children å¼•ç”¨å­è·¯ç”±çš„å†…å®¹ã€‚

```tsx
// routes/blog.tsx
import { RouteSectionProps } from "@solidjs/router";

export default function BlogLayout(props: RouteSectionProps) {
  return <div>{props.children}</div>;
}
```

> **æ³¨æ„**ï¼šåˆ›å»º blog/index.tsx æˆ– blog/(blogIndex).tsx ä¸å¸ƒå±€ä¸åŒï¼Œå®ƒä»¬ä»…ç”¨äºæ¸²æŸ“ç´¢å¼•è·¯ç”±ï¼ˆindex routeï¼‰ã€‚

### é‡å‘½å Index

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹ä¸­çš„ index.tsx çš„é»˜è®¤å¯¼å‡ºç»„ä»¶ä¼šè¢«æ¸²æŸ“ä¸ºè¯¥è·¯ç”±çš„é¡µé¢ã€‚ç„¶è€Œï¼Œå½“é¡¹ç›®ä¸­å­˜åœ¨å¤šä¸ª index.tsx æ–‡ä»¶æ—¶ï¼ŒæŸ¥æ‰¾æ­£ç¡®çš„æ–‡ä»¶å¯èƒ½ä¼šå˜å¾—å›°éš¾ã€‚

ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œä½ å¯ä»¥å°† index.tsx é‡å‘½åä¸ºæ–‡ä»¶å¤¹çš„åç§°ï¼Œå¹¶ç”¨æ‹¬å·åŒ…è£¹ã€‚

è¿™æ ·ï¼Œå®ƒå°†è¢«è§†ä¸ºè¯¥è·¯ç”±çš„é»˜è®¤å¯¼å‡ºç»„ä»¶ï¼Œä¾‹å¦‚ï¼š

```tsx
|-- routes/                       // example.com
    |-- blog/
        |-- article-1.tsx         // example.com/blog/article-1
        |-- article-2.tsx
    |-- work/
        |-- job-1.tsx             // example.com/work/job-1
        |-- job-2.tsx
    |-- socials/
        |-- (socials).tsx         // example.com/socials
```

#### é€ƒç¦»åµŒå¥—è·¯ç”±

å½“ä½ æœ‰ä¸€ä¸ªåµŒå¥—è·¯å¾„ï¼Œä½†å¸Œæœ›å®ƒä½¿ç”¨ä¸åŒçš„å¸ƒå±€æ—¶ï¼Œå¯ä»¥é€šè¿‡åœ¨æ–‡ä»¶åä¸­ä½¿ç”¨æ‹¬å· ( ) æ¥â€œé€ƒç¦»â€åµŒå¥—è·¯ç”±ã€‚

è¿™æ ·å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„è·¯ç”±ï¼Œè€Œä¸éš¶å±äºå‰ä¸€ä¸ªè·¯ç”±çš„åµŒå¥—ç»“æ„ã€‚

```tsx
|-- routes/                       // example.com
    |-- users/
        |-- index.tsx            // example.com/users
        |-- projects.tsx         // example.com/users/projects
    |-- users(details)/
        |-- [id].tsx            // example.com/users/1
```

æ­¤å¤–ï¼Œä½ è¿˜å¯ä»¥ä¸ºè¯¥è·¯ç”±è‡ªèº«åˆ›å»ºåµŒå¥—å¸ƒå±€ï¼š

```tsx
|-- routes/
    |-- users.tsx
    |-- users(details).tsx
    |-- users/
        |-- index.tsx
        |-- projects.tsx
    |-- users(details)/
        |-- [id].tsx
```

#### åŠ¨æ€è·¯ç”±

åŠ¨æ€è·¯ç”±å…è®¸æŸä¸ªè·¯ç”±æ®µåŒ¹é…ä»»æ„å€¼ã€‚å½“ URL è·¯å¾„åŒ…å«åŠ¨æ€æ®µæ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ‹¬å· [] æ¥å®šä¹‰ï¼š

- example.com/users/:id âœ /routes/users/[id].tsx
- example.com/users/:id/:name âœ /routes/users/[id]/[name].tsx
- example.com/*missing âœ /routes/[...missing].tsx

è¿™ä½¿ä½ èƒ½å¤Ÿåˆ›å»ºå•ä¸€è·¯ç”±æ¥åŒ¹é…è¯¥è·¯å¾„æ®µçš„ä»»æ„å€¼ã€‚ä¾‹å¦‚ï¼Œ/users/1 å’Œ /users/2 éƒ½æ˜¯æœ‰æ•ˆè·¯ç”±ï¼Œè€Œæ— éœ€ä¸ºæ¯ä¸ªç”¨æˆ·å®šä¹‰ç‹¬ç«‹è·¯ç”±ï¼Œå¯ä»¥ä½¿ç”¨åŠ¨æ€è·¯ç”±åŒ¹é… id æ®µçš„ä»»æ„å€¼ã€‚

```tsx
|-- routes/
    |-- users/
        |-- [id].tsx
```

ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨ solid-router æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ useParams åŸè¯­æ¥è·å–åŠ¨æ€è·¯ç”±æ®µçš„å€¼ï¼š

```tsx
import { useParams } from "@solidjs/router";

export default function UserPage() {
  const params = useParams();
  return <div>User {params.id}</div>;
}
```

**å¯é€‰å‚æ•°ï¼ˆOptional Parameterï¼‰**

å¦‚æœè·¯ç”±ä¸­æœ‰å¯é€‰å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨åŒæ–¹æ‹¬å· [[id]] æ¥å®šä¹‰åŠ¨æ€æ®µã€‚è¿™å°†åŒ¹é…åŒ…å«æˆ–ä¸åŒ…å«è¯¥å‚æ•°çš„è·¯ç”±ã€‚

```
|-- routes/
    |-- users/
        |-- [[id]].tsx
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€äº›å¯èƒ½åŒ¹é…çš„é¡µé¢ç¤ºä¾‹åŒ…æ‹¬ï¼š

- `/users`
- `/users/1`
- `/users/abc`



**å…¨åŒ¹é…è·¯ç”±ï¼ˆCatch-all Routesï¼‰**

å…¨åŒ¹é…è·¯ç”±æ˜¯ä¸€ç§ç‰¹æ®Šçš„åŠ¨æ€è·¯ç”±ï¼Œå¯ä»¥åŒ¹é…ä»»æ„æ•°é‡çš„è·¯å¾„æ®µã€‚

å®šä¹‰æ–¹æ³•æ˜¯åœ¨æ–¹æ‹¬å·ä¸­ä½¿ç”¨ ... å‰ç¼€ï¼Œä¾‹å¦‚ï¼š[...post]ã€‚

```
|-- routes/
    |-- blog/
        |-- index.tsx
        |-- [...post].tsx
```

å…¨åŒ¹é…è·¯ç”±ä¼šæœ‰ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯ä»æœ€åä¸€ä¸ªæœ‰æ•ˆæ®µå¼€å§‹çš„æ‰€æœ‰ URL æ®µç»„æˆçš„ä»¥æ–œæ åˆ†éš”çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼š

- å¯¹äºè·¯ç”± [...post] å’Œ URL /post/fooï¼ŒuseParams è¿”å›çš„å¯¹è±¡ä¸­ post å±æ€§å€¼ä¸º post/fooã€‚
- å¯¹äº URL /post/foo/bazï¼Œpost å±æ€§å€¼ä¸º post/foo/bazã€‚

```tsx
import { useParams } from "@solidjs/router";

export default function BlogPage() {
  const params = useParams();
  return <div>Blog {params.post}</div>;
}
```

### è·¯ç”±åˆ†ç»„ï¼ˆRoute Groupsï¼‰

ä½¿ç”¨è·¯ç”±åˆ†ç»„ï¼Œå¯ä»¥åœ¨ä¸å½±å“ URL ç»“æ„çš„æƒ…å†µä¸‹ç»„ç»‡è·¯ç”±ã€‚ç”±äºåŸºäºæ–‡ä»¶çš„è·¯ç”±ä¾èµ–æ–‡ä»¶ç³»ç»Ÿï¼Œç›´æ¥ç»„ç»‡æ–‡ä»¶å¤¹å¯èƒ½ä¸åˆ©äºé¡¹ç›®ç»“æ„çš„æ¸…æ™°æ€§ã€‚

åœ¨ SolidStart ä¸­ï¼Œè·¯ç”±åˆ†ç»„é€šè¿‡åœ¨æ–‡ä»¶å¤¹åç§°å¤–ä½¿ç”¨æ‹¬å·()æ¥å®šä¹‰ï¼š

```
|-- routes/
    |-- (static)
        |-- about-us                // example.com/about-us
            |-- index.tsx
        |-- contact-us              // example.com/contact-us
            |-- index.tsx
```

### é¢å¤–çš„è·¯ç”±é…ç½®

SolidStart æä¾›äº†ä¸€ç§åœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹å¤–æ·»åŠ è·¯ç”±é…ç½®çš„æ–¹æ³•ã€‚ç”±äº SolidStart æ”¯æŒä½¿ç”¨å…¶ä»–è·¯ç”±å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ \<FileRoutes /> æä¾›çš„è·¯ç”±å¯¼å‡ºï¼ˆroute exportï¼‰æ¥ä¸ºä½ é€‰æ‹©çš„è·¯ç”±å™¨å®šä¹‰é¢å¤–çš„è·¯ç”±é…ç½®ã€‚

```tsx
import type { RouteSectionProps, RouteDefinition } from "@solidjs/router";

export const route = {
  preload() {
    // define preload function
  }
} satisfies RouteDefinition

export default function UsersLayout(props: RouteSectionProps) {
  return (
    <div>
      <h1>Users</h1>
      {props.children}
    </div>
  );
}
```

## API è·¯ç”±ï¼ˆAPI Routesï¼‰

è™½ç„¶æœåŠ¡å™¨å‡½æ•°ï¼ˆServer Functionsï¼‰é€‚åˆä¸º UI æä¾›æ‰€éœ€çš„æ•°æ®ç¼–å†™æœåŠ¡ç«¯ä»£ç ï¼Œä½†æœ‰æ—¶ä½ éœ€è¦å…¬å¼€ API è·¯ç”±ã€‚éœ€è¦ API è·¯ç”±çš„åœºæ™¯åŒ…æ‹¬ï¼š

- æœ‰é¢å¤–çš„å®¢æˆ·ç«¯éœ€è¦å…±äº«åŒä¸€é€»è¾‘ã€‚
- å…¬å¼€ GraphQL æˆ– tRPC æ¥å£ã€‚
- æä¾›é¢å‘å…¬ä¼—çš„ REST APIã€‚
- ç¼–å†™ Webhook æˆ– OAuth çš„å›è°ƒå¤„ç†ç¨‹åºã€‚
- æä¾›é HTML ç±»å‹çš„æ–‡æ¡£ï¼Œå¦‚ PDF æˆ–å›¾ç‰‡ã€‚

ä¸ºæ­¤ï¼ŒSolidStart æä¾›äº†ä¸€ç§æ˜“äºç†è§£å’Œç»´æŠ¤çš„æ–¹å¼æ¥ç¼–å†™ API è·¯ç”±ã€‚API è·¯ç”±ä¸ UI è·¯ç”±ç±»ä¼¼ï¼Œå¹¶éµå¾ªç›¸åŒçš„æ–‡ä»¶å‘½åçº¦å®šã€‚

**åŒºåˆ«**ï¼š

- UI è·¯ç”±é»˜è®¤å¯¼å‡ºä¸€ä¸ª Solid ç»„ä»¶ã€‚
- API è·¯ç”±ä¸å¯¼å‡ºç»„ä»¶ï¼Œè€Œæ˜¯å¯¼å‡ºä»¥å¤„ç†çš„ HTTP æ–¹æ³•å‘½åçš„å‡½æ•°ï¼Œä¾‹å¦‚ GETã€POST ç­‰ã€‚

> **æ³¨æ„**ï¼šAPI è·¯ç”±ä¼˜å…ˆäºåŒè·¯å¾„çš„ UI è·¯ç”±ã€‚å¦‚æœå¸Œæœ›ä¸¤è€…åœ¨ç›¸åŒè·¯å¾„ä¸Šå…±å­˜ï¼Œè¯·è®°å¾—ä½¿ç”¨ Accept å¤´ã€‚å¯¹äº GET è·¯ç”±ï¼Œå¦‚æœæ²¡æœ‰è¿”å›å“åº”ï¼Œå°†å›é€€åˆ° UI è·¯ç”±å¤„ç†ã€‚

### ç¼–å†™API è·¯ç”±

è¦ç¼–å†™ API è·¯ç”±ï¼Œå¯ä»¥åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹æ¥å­˜æ”¾è·¯ç”±æ–‡ä»¶ã€‚è™½ç„¶æ–‡ä»¶å¤¹å¯ä»¥å‘½åä¸ºä»»æ„åç§°ï¼Œä½†é€šå¸¸ä¼šå‘½åä¸º apiï¼Œä»¥è¡¨æ˜è¯¥ç›®å½•ä¸‹çš„è·¯ç”±ç”¨äºå¤„ç† API è¯·æ±‚ã€‚

```tsx
export function GET() {
  // ...
}

export function POST() {
  // ...
}

export function PATCH() {
  // ...
}

export function DELETE() {
  // ...
}
```

API è·¯ç”±ä¼šæ¥æ”¶ä¸€ä¸ª APIEvent å¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚è¯¥å¯¹è±¡åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

- **request**ï¼šè¡¨ç¤ºå®¢æˆ·ç«¯å‘é€è¯·æ±‚çš„ Request å¯¹è±¡ã€‚
- **params**ï¼šåŒ…å«åŠ¨æ€è·¯ç”±å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå¯¹äºè·¯ç”± /api/users/:idï¼Œå½“è¯·æ±‚ /api/users/123 æ—¶ï¼Œparams ä¸º { id: 123 }ã€‚
- **fetch**ï¼šå†…éƒ¨ fetch å‡½æ•°ï¼Œå¯ç”¨äºå‘å…¶ä»– API è·¯ç”±å‘é€è¯·æ±‚ï¼Œæ— éœ€å…³å¿ƒ URL çš„ originã€‚

API è·¯ç”±åº”è¿”å› JSON æˆ– Response å¯¹è±¡ã€‚ä¸ºäº†å¤„ç†å¤šç§ HTTP æ–¹æ³•ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ª handler å‡½æ•°ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°å¤šä¸ªæ–¹æ³•ï¼š

```tsx
async function handler() {
  // å¤„ç†é€»è¾‘
}

export const GET = handler;
export const POST = handler;
// ...
```

ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ API è·¯ç”±ï¼Œå®ƒæ ¹æ®æŒ‡å®šçš„ç±»åˆ«å’Œå“ç‰Œè¿”å›äº§å“åˆ—è¡¨ï¼š

```tsx
import type { APIEvent } from "@solidjs/start/server";
import store from "./store";

export async function GET({ params }: APIEvent) {
  console.log(`Category: ${params.category}, Brand: ${params.brand}`);
  const products = await store.getProducts(params.category, params.brand);
  return products;
}
```

### ä¼šè¯ç®¡ç†

ç”±äº HTTP æ˜¯æ— çŠ¶æ€åè®®ï¼Œä½ éœ€è¦åœ¨æœåŠ¡å™¨ç«¯ç®¡ç†ä¼šè¯çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæƒ³è¯†åˆ«ç”¨æˆ·èº«ä»½ï¼Œæœ€å®‰å…¨çš„æ–¹å¼æ˜¯ä½¿ç”¨ **HTTP-only cookies**ã€‚Cookie å¯ä»¥åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­å­˜å‚¨æ•°æ®ï¼Œå¹¶åœ¨å¤šä¸ªè¯·æ±‚ä¹‹é—´ä¿æŒæŒä¹…æ€§ã€‚

ç”¨æˆ·è¯·æ±‚é€šè¿‡ Request å¯¹è±¡ä¼ å…¥ã€‚ä½ å¯ä»¥è§£æè¯·æ±‚å¤´ä¸­çš„ Cookie æ¥è®¿é—® cookiesï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨ vinxi/http æä¾›çš„è¾…åŠ©å‡½æ•°æ¥ç®€åŒ–æ“ä½œã€‚

```tsx
import type { APIEvent } from "@solidjs/start/server";
import { getCookie } from "vinxi/http";
import store from "./store";

export async function GET(event: APIEvent) {
  const userId = getCookie("userId");
  if (!userId) {
    return new Response("Not logged in", { status: 401 });
  }
  const user = await store.getUser(event.params.userId);
  if (user.id !== userId) {
    return new Response("Not authorized", { status: 403 });
  }
  return user;
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå¯ä»¥çœ‹åˆ° userId æ˜¯ä» cookie ä¸­è¯»å–çš„ï¼Œç„¶åç”¨äºåœ¨ store ä¸­æŸ¥æ‰¾å¯¹åº”çš„ç”¨æˆ·ã€‚æœ‰å…³å¦‚ä½•ä½¿ç”¨ cookie è¿›è¡Œå®‰å…¨ä¼šè¯ç®¡ç†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒä¼šè¯ç®¡ç†æ–‡æ¡£ã€‚

### æš´éœ² GraphQL API

SolidStart ä½¿å®ç° GraphQL API å˜å¾—ç®€å•ã€‚GraphQL æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ï¼ŒåŒæ—¶æä¾›è¿è¡Œæ—¶ï¼Œç”¨äºæ ¹æ®ä½ å®šä¹‰çš„æ•°æ®ç±»å‹ç³»ç»Ÿæ‰§è¡ŒæŸ¥è¯¢ã€‚

è¦å®ç° GraphQL APIï¼Œä½ éœ€è¦å®šä¹‰ **schema** å’Œ **resolvers**ã€‚graphql å‡½æ•°æ¥å—ä¸€ä¸ª GraphQL schemaï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯ç”¨ä½œ API è·¯ç”±å¤„ç†å™¨çš„å‡½æ•°ã€‚

**å®ç°æ­¥éª¤ï¼š**

1. å®‰è£… graphql åº“ã€‚
2. åœ¨æ–‡ä»¶ä¸­å®ç°ä½ çš„ schema å’Œ resolversã€‚
3. å¯¼å‡ºä¸€ä¸ª handler å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ä½œä¸º API è·¯ç”±ä½¿ç”¨ã€‚

```tsx
import { buildSchema, graphql } from "graphql";
import type { APIEvent } from "@solidjs/start/server";

// Define GraphQL Schema
const schema = buildSchema(`
  type Message {
      message: String
  }

  type Query {
    hello(input: String): Message
    goodbye: String
  }
`);

// Define GraphQL Resolvers
const rootValue = {
  hello: () => {
    return {
      message: "Hello World"
    };
  },
  goodbye: () => {
    return "Goodbye";
  }
};

// request handler
const handler = async (event: APIEvent) => {
  // get request body
  const body = await new Response(event.request.body).json();

  // pass query and save results
  const result = await graphql({ rootValue, schema, source: body.query });

  // send query result
  return result;
};

export const GET = handler;

export const POST = handler;

```

### æš´éœ² tRPC æœåŠ¡å™¨è·¯ç”±

tRPC æ˜¯ä¸€ä¸ªç°ä»£çš„ã€ä»¥ TypeScript ä¸ºä¼˜å…ˆçš„ API æ¡†æ¶ï¼Œè®¾è®¡ä¸Šæ˜“äºä½¿ç”¨å’Œç†è§£ã€‚

è¦æš´éœ² tRPC æœåŠ¡å™¨è·¯ç”±ï¼Œéœ€è¦å…ˆç¼–å†™ä½ çš„ **router**ã€‚ç¼–å†™å®Œæˆåï¼Œå¯ä»¥å°†å…¶æ”¾åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿ä¸ºå®¢æˆ·ç«¯å¯¼å‡ºç±»å‹ï¼š

```tsx
import { initTRPC } from "@trpc/server";
import { wrap } from "@decs/typeschema";
import { string } from "valibot";

const t = initTRPC.create();

export const appRouter = t.router({
  hello: t.procedure.input(wrap(string())).query(({ input }) => {
    return `hello ${input ?? "world"}`;
  })
});

export type AppRouter = typeof appRouter;
```

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å®¢æˆ·ç«¯ç¤ºä¾‹ï¼Œå¯ç”¨äºä»ä½ çš„ tRPC æœåŠ¡å™¨è·å–æ•°æ®ï¼š

```tsx
import { createTRPCProxyClient, httpBatchLink, loggerLink } from "@trpc/client";
import type { AppRouter } from "./router";

export const client = createTRPCProxyClient<AppRouter>({
  links: [loggerLink(), httpBatchLink({ url: "http://localhost:3000/api/trpc" })]
});
```

æœ€åï¼Œä½ å¯ä»¥ä½¿ç”¨ **fetch é€‚é…å™¨ï¼ˆfetch adapterï¼‰** æ¥ç¼–å†™ä¸€ä¸ª API è·¯ç”±ï¼Œä½¿å…¶å……å½“ tRPC æœåŠ¡å™¨ã€‚

```tsx
import { type APIEvent } from "@solidjs/start/server";
import { fetchRequestHandler } from "@trpc/server/adapters/fetch";
import { appRouter } from "~/lib/router";

const handler = (event: APIEvent) =>
  fetchRequestHandler({
    endpoint: "/api/trpc",
    req: event.request,
    router: appRouter,
    createContext: () => ({})
  });

export const GET = handler;

export const POST = handler;
```

## CSS ä¸æ ·å¼

SolidStart æ˜¯ä¸€ä¸ªåŸºäºæ ‡å‡†çš„æ¡†æ¶ï¼Œå®ƒä¸ä¼šä¿®æ”¹ \<style> æ ‡ç­¾çš„è¡Œä¸ºï¼Œè€Œæ˜¯è‡´åŠ›äºåœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•å’Œæ„å»ºã€‚

### ç»„ä»¶æ ·å¼

Vite ä¸ºå¤æ‚çš„ Web åº”ç”¨æä¾›äº†ä¸€ç§ç®€ä¾¿çš„ CSS ç®¡ç†æ–¹å¼ã€‚å®ƒå…è®¸ç”¨æˆ·åœ¨ç»„ä»¶æ ‘çš„ä»»æ„ä½ç½®é€šè¿‡ ESM è¯­æ³•å¯¼å…¥ CSSã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åœ¨ä¸ç»„ä»¶æ–‡ä»¶é…å¥—çš„ CSS æ–‡ä»¶ä¸­ç¼–å†™æ ·å¼ï¼š

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Card.tsx
â”‚   â”œâ”€â”€ Card.css
```

è¦åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ CSSï¼Œå¯ä»¥åœ¨ Card.css æ–‡ä»¶ä¸­å®šä¹‰æ ·å¼ï¼Œç„¶ååœ¨ Card.tsx æ–‡ä»¶ä¸­å¯¼å…¥ï¼š

```css
.card {
  background-color: #446b9e;
}

h1 {
  font-size: 1.5em;
  font-weight: bold;
}

p {
  font-size: 1em;
  font-weight: normal;
}
```

```tsx
import "./Card.css";

const Card = (props) => {
  return (
    <div class="card">
      <h1>{props.title}</h1>
      <p>{props.text}</p>
    </div>
  );
};
```

#### CSS Modules

SolidStart ä¹Ÿæ”¯æŒ Vite çš„ **CSS Modules**ã€‚é€šè¿‡ CSS Modulesï¼Œå¯ä»¥å°†æŸäº›æ ·å¼é™å®šåœ¨ç»„ä»¶èŒƒå›´å†…ï¼ŒåŒæ—¶å…è®¸åœ¨å¤šä¸ªç»„ä»¶ä¸­ä½¿ç”¨ç›¸åŒçš„ CSS ç±»æ¥å®ç°ä¸åŒçš„æ ·å¼ã€‚

ä½¿ç”¨æ–¹æ³•ï¼š

- CSS æ–‡ä»¶å¿…é¡»ä»¥ .module.css ç»“å°¾ã€‚
- åŒæ ·çš„çº¦å®šé€‚ç”¨äº Sass æ–‡ä»¶ï¼š.module.scss æˆ– .module.sassã€‚

```css
.card {
  background-color: #446b9e;
}

div.card > h1 {
  font-size: 1.5em;
  font-weight: bold;
}

div.card > p {
  font-size: 1em;
  font-weight: normal;
}
```

åœ¨é¦–æ¬¡ä½¿ç”¨ CSS Modules æ—¶ï¼Œå¦‚æœç›´æ¥åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ class å±æ€§ï¼Œå¯èƒ½ä¼šé‡åˆ°é”™è¯¯ã€‚è¿™æ˜¯å› ä¸º CSS Modules èƒŒåçš„æœºåˆ¶ä¼šå°†å®šä¹‰çš„ç±»åé‡å‘½åä¸ºä¸€ä¸²éšæœºå­—ç¬¦ã€‚å¦‚æœç¡¬ç¼–ç ä½¿ç”¨ class="card"ï¼ŒSolid æ— æ³•è¯†åˆ«å¹¶å°†å…¶é‡å‘½åã€‚

äº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å°† CSS Module ä¸­ä½¿ç”¨çš„ç±»å¯¼å…¥ç»„ä»¶ã€‚å¯¼å…¥å¯¹è±¡å¯ä»¥ç†è§£ä¸º humanClass: generatedClass çš„æ˜ å°„ï¼Œåœ¨ç»„ä»¶ä¸­ï¼Œé€šè¿‡é”®åï¼ˆå³å…ƒç´ ä¸Šçš„ç±»åï¼‰è·å–ç”Ÿæˆçš„å”¯ä¸€ç±»åã€‚ä¾‹å¦‚ï¼š

```tsx
import styles from "./Card.module.css";

const Card = (props) => {
  return (
    <div class={styles.card}>
      <h1>{props.title}</h1>
      <p>{props.text}</p>
    </div>
  );
};
```

## æ•°æ®åŠ è½½

SolidStart æ—¨åœ¨ç®€åŒ–ä»æ•°æ®æºåŠ è½½æ•°æ®çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿ä¿æŒ UI ä¸æ•°æ®åŒæ­¥ã€‚å¯¹äºå¤§å¤šæ•°æ•°æ®éœ€æ±‚ï¼Œé€šå¸¸é€šè¿‡è·¯ç”±æ¥å†³å®šåŠ è½½å“ªäº›æ•°æ®ã€‚

SolidStart æ”¯æŒåµŒå¥—è·¯ç”±ï¼Œè¿™æœ‰åŠ©äºä»¥å±‚çº§åŒ–çš„æ–¹å¼ç»„ç»‡åº”ç”¨çš„ UIï¼ŒåŒæ—¶å¯ä»¥å…±äº«å¸ƒå±€ï¼Œæé«˜ä»£ç å¤ç”¨æ€§ã€‚

### å®¢æˆ·ç«¯æ•°æ®åŠ è½½

Solid æä¾›äº† createResource åŸè¯­ï¼Œç”¨äºä»æ•°æ®æºåŠ è½½æ•°æ®ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå¼‚æ­¥å‡½æ•°å¹¶è¿”å›ä¸€ä¸ª signalã€‚

createResource å¯ä»¥ä¸ Suspense å’Œ ErrorBoundary é›†æˆï¼Œç”¨äºç®¡ç†æ•°æ®åŠ è½½çš„ç”Ÿå‘½å‘¨æœŸå’Œé”™è¯¯çŠ¶æ€ï¼Œä¾‹å¦‚ï¼š

```tsx
// src/routes/users.tsx
import { For, createResource } from "solid-js";

type User = { name: string; house: string };

export default function Page() {
  const [users] = createResource(async () => {
    const response = await fetch("https://example.com/users");
    return (await response.json()) as User[];
  });

  return <For each={users()}>{(user) => <li>{user.name}</li>}</For>;
}
```

åœ¨ç»„ä»¶å†…éƒ¨è¿›è¡Œæ•°æ®è·å–æ—¶ï¼Œå°¤å…¶æ˜¯åœ¨æ‡’åŠ è½½çš„åµŒå¥—éƒ¨åˆ†ä¸‹ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸å¿…è¦çš„ç€‘å¸ƒåŠ è½½é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå»ºè®®å°†æ•°æ®è·å–æå‡åˆ°ç»„ä»¶æ ‘çš„é¡¶éƒ¨ï¼Œæˆ–è€…åœ¨ SolidStart ä¸­ä½¿ç”¨æœåŠ¡å™¨ä»¥éé˜»å¡æ–¹å¼è·å–æ•°æ®ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ solid-router ä¸­çš„ API æ•°æ®ã€‚

åˆ©ç”¨ solid-router çš„ä¸€äº›ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ•°æ®åˆ›å»ºç¼“å­˜ï¼š

```tsx
// /routes/users.tsx
import { For } from "solid-js";
import { createAsync, query } from "@solidjs/router";

type User = { name: string; email: string };

const getUsers = query(async () => {
  const response = await fetch("https://example.com/users");
  return (await response.json()) as User[];
}, "users");

export const route = {
  preload: () => getUsers(),
};

export default function Page() {
  const users = createAsync(() => getUsers());

  return <For each={users()}>{(user) => <li>{user.name}</li>}</For>;
}
```

ä½¿ç”¨è¿™ç§æ–¹æ³•æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

- **é¢„åŠ è½½å‡½æ•°è°ƒç”¨æ—¶æœº**ï¼špreload å‡½æ•°æ¯æ¡è·¯ç”±åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œå³ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®è¯¥è·¯ç”±æ—¶ã€‚ä¹‹åï¼Œä¿æŒæ´»è·ƒçš„ç»†ç²’åº¦èµ„æºä¼šéšç€çŠ¶æ€æˆ– URL çš„å˜åŒ–åŒæ­¥ï¼Œä»¥åœ¨éœ€è¦æ—¶é‡æ–°è·å–æ•°æ®ã€‚å¦‚æœæ•°æ®éœ€è¦åˆ·æ–°ï¼Œå¯ä»¥ä½¿ç”¨ createResource è¿”å›çš„ refetch å‡½æ•°ã€‚
- **ä¸Šä¸‹æ–‡é™åˆ¶**ï¼šåœ¨è·¯ç”±æ¸²æŸ“ä¹‹å‰ä¼šè°ƒç”¨ preload å‡½æ•°ï¼Œå®ƒä¸è·¯ç”±çš„ä¸Šä¸‹æ–‡ä¸å…±äº«ã€‚æš´éœ²ç»™ preload çš„ä¸Šä¸‹æ–‡æ ‘æ˜¯ Page ç»„ä»¶ä¹‹ä¸Šçš„éƒ¨åˆ†ã€‚
- **æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯**ï¼špreload å‡½æ•°åœ¨æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯éƒ½ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœèµ„æºåœ¨æœåŠ¡å™¨æ¸²æŸ“æ—¶åºåˆ—åŒ–äº†æ•°æ®ï¼Œå¯ä»¥é¿å…é‡å¤è·å–ã€‚æœåŠ¡å™¨ç«¯æ¸²æŸ“ä»…åœ¨èµ„æºä¿¡å·ä½äº Suspense è¾¹ç•Œä¸‹è¢«è®¿é—®æ—¶æ‰ä¼šç­‰å¾…èµ„æºè·å–å¹¶åºåˆ—åŒ–æ•°æ®ã€‚

### æ•°æ®å§‹ç»ˆåœ¨æœåŠ¡å™¨ç«¯åŠ è½½

ä½œä¸ºå…¨æ ˆ JavaScript æ¡†æ¶çš„ä¸€ä¸ªä¼˜åŠ¿æ˜¯ï¼Œå¯ä»¥è½»æ¾ç¼–å†™åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½èƒ½è¿è¡Œçš„æ•°æ®åŠ è½½ä»£ç ã€‚

SolidStart æä¾›äº†ä¸€ç§æ–¹æ³•ï¼šé€šè¿‡ "**use server**" æ³¨é‡Šï¼Œä½ å¯ä»¥å‘Šè¯‰æ‰“åŒ…å·¥å…·åˆ›å»ºä¸€ä¸ª RPCï¼Œè€Œä¸å°†ä»£ç åŒ…å«åœ¨å®¢æˆ·ç«¯åŒ…ä¸­ã€‚è¿™å…è®¸ä½ ç¼–å†™ä»…åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œçš„ä»£ç ï¼Œè€Œæ— éœ€ä¸ºå…¶åˆ›å»º API è·¯ç”±ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥ç”¨äºæ•°æ®åº“è®¿é—®ã€å†…éƒ¨ APIï¼Œæˆ–è€…åœ¨å‡½æ•°å†…éƒ¨éœ€è¦ä½¿ç”¨æœåŠ¡å™¨èµ„æºæ—¶ã€‚

```tsx
// /routes/users.tsx
import { For } from "solid-js";
import { createAsync, query } from "@solidjs/router";

type User = { name: string; email: string };

const getUsers = query(async () => {
  "use server";
  return store.users.list();
}, "users");

export const route = {
  preload: () => getUsers(),
};

export default function Page() {
  const users = createAsync(() => getUsers());

  return <For each={users()}>{(user) => <li>{user.name}</li>}</For>;
}
```

## Head ä¸å…ƒæ•°æ®

SolidStart æœ¬èº«ä¸è‡ªå¸¦å…ƒæ•°æ®åº“ã€‚å¦‚æœä½ å¸Œæœ›è‡ªå®šä¹‰æ–‡æ¡£ \<head> ä¸­çš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ @solidjs/meta åº“ã€‚

```shell
$ pnpm add @solidjs/meta
```

åœ¨ \<head> ä¸­å¸¸ç”¨çš„å…ƒç´ åŒ…æ‹¬ï¼š

- titleï¼šæŒ‡å®šé¡µé¢æ ‡é¢˜ï¼Œç”¨äºæµè§ˆå™¨æ ‡ç­¾å’Œæœç´¢ç»“æœæ ‡é¢˜ã€‚
- metaï¼šæŒ‡å®šé¡µé¢çš„å„ç§å…ƒæ•°æ®ï¼Œä¾‹å¦‚ faviconã€å­—ç¬¦é›†ï¼Œæˆ–ç”¨äº SEO çš„ OG æ ‡ç­¾ã€‚
- linkï¼šæ·»åŠ æ ·å¼è¡¨æˆ–è„šæœ¬ç­‰èµ„æºï¼Œä»¥ä¾›æµè§ˆå™¨åŠ è½½ã€‚
- styleï¼šå‘é¡µé¢æ·»åŠ å†…è”æ ·å¼ã€‚

### åœ¨ Route ç»„ä»¶å†…éƒ¨

å½“éœ€è¦ä¸ºç‰¹å®šè·¯ç”±è®¾ç½®å…ƒæ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ \<Title />ï¼š

```tsx
mport { Title } from "@solidjs/meta";

export default function About() {
  return (
    <>
      <Title>About</Title>
      <h1>About</h1>
    </>
  );
}
```

è¿™äº›æ ‡ç­¾åªä¼šåº”ç”¨äºè¯¥ç‰¹å®šè·¯ç”±ï¼Œå½“ç”¨æˆ·ç¦»å¼€é¡µé¢æ—¶ä¼šä» document.head ä¸­ç§»é™¤ã€‚routeData ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ï¼Œç”¨äºæ ¹æ®è·¯ç”±çš„åŠ¨æ€éƒ¨åˆ†ç”Ÿæˆç‰¹å®šçš„æ ‡é¢˜å’Œ SEO å…ƒæ•°æ®ã€‚

### åœ¨ Title ä¸­æ·»åŠ ç½‘ç«™åç¼€

å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰ç»„ä»¶æ¥åŒ…è£… \<Title />ï¼Œä¸ºæ‰€æœ‰æ ‡é¢˜æ·»åŠ ç½‘ç«™ç‰¹å®šçš„å‰ç¼€æˆ–åç¼€ï¼š

```tsx
export default function MySiteTitle(props) {
  return <Title>{props.children} | My Site</Title>;
}
```

```tsx
import MySiteTitle from "~/components/MySiteTitle";

export default function About() {
  return (
    <>
      <MySiteTitle>About</MySiteTitle>
      <h1>About</h1>
    </>
  );
}
```

### åœ¨ Title ä¸­ä½¿ç”¨å¼‚æ­¥æ•°æ®

å¯ä»¥ä½¿ç”¨èµ„æºï¼ˆresourcesï¼‰æ ¹æ®è·¯ç”±çš„åŠ¨æ€éƒ¨åˆ†ç”Ÿæˆç‰¹å®šçš„æ ‡é¢˜ï¼š

```tsx
import { Title } from "@solidjs/meta";
import { RouteSectionProps } from "@solidjs/router";
import { createResource, Show } from "solid-js";

export default function User(props: RouteSectionProps) {
  const [user] = createResource(() => fetchUser(props.params.id));

  return (
    <Show when={user()}>
      <Title>{user()?.name}</Title>
      <h1>{user()?.name}</h1>
    </Show>
  );
}

```

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ routeData ä» /users/:id è·¯ç”±ä¸­çš„ id è·å–ç”¨æˆ·å§“åï¼Œå¹¶å°†å…¶ç”¨äº \<Title /> ç»„ä»¶ã€‚åŒæ ·ï¼Œå…¶ä»–ä¿¡æ¯ä¹Ÿå¯ä»¥ç”¨äºç”Ÿæˆ SEO æ‰€éœ€çš„å…¶ä»–æ ‡ç­¾ã€‚

### æ·»åŠ  SEO æ ‡ç­¾

å¯ä»¥ä½¿ç”¨ \<Meta /> ç»„ä»¶æ·»åŠ  SEO æ ‡ç­¾ï¼Œä¾‹å¦‚ og:titleã€og:descriptionã€og:imageã€‚

ç”±äºè¿™äº›æ ‡ç­¾å¯èƒ½éœ€è¦åœ¨å¤šä¸ªè·¯ç”±ä¸­ä½¿ç”¨ï¼Œå¯ä»¥å°†å®ƒä»¬æ·»åŠ åˆ° root.tsx æ–‡ä»¶çš„ \<Head> å†…ã€‚

```tsx
export default function Root() {
  return (
    <Html lang="en">
      <Head>
        <Meta
          property="og:image"
          content="https://example.com/image.jpg"
        />
        <Meta
          property="og:image:alt"
          content="Welcome to my site"
        />
        <Meta property="og:image:width" content="1200" />
        <Meta property="og:image:height" content="600" />
        <Meta property="og:site_name" content="GitHub" />
      </Head>
    </Html>
  );
}
```

å¦‚æœéœ€è¦åœ¨ç‰¹å®šè·¯ç”±ä¸­æ·»åŠ è·¯ç”±ä¸“å±ä¿¡æ¯ï¼Œå¯ä»¥åƒä½¿ç”¨ \<Title /> ä¸€æ ·ï¼Œåœ¨è¯¥è·¯ç”±å†…éƒ¨ä½¿ç”¨ \<Meta /> ç»„ä»¶ã€‚è¿™ä¼šè¦†ç›– \<Head /> ç»„ä»¶ä¸­ä½¿ç”¨çš„ Meta æ ‡ç­¾ã€‚

```tsx
import MySiteTitle from "~/components/MySiteTitle";

export default function About() {
  return (
    <>
      <MySiteTitle>About</MySiteTitle>
      <Meta name="description" content="This is my content tag." />
      <Meta
        property="og:title"
        content="Welcome to my site!"
      />
      <Meta
        property="og:description"
        content="A website"
      />
      <h1>About</h1>
    </>
  );
}
```

## è·¯ç”±é¢„æ¸²æŸ“

è·¯ç”±é¢„æ¸²æŸ“æ”¯æŒé™æ€ç«™ç‚¹ç”Ÿæˆï¼ˆSSGï¼‰ï¼Œé€šè¿‡åœ¨æ„å»ºè¿‡ç¨‹ä¸­ç”Ÿæˆé™æ€ HTML é¡µé¢ï¼Œå®ç°æ›´å¿«çš„åŠ è½½é€Ÿåº¦å’Œæ›´å¥½çš„ SEOã€‚è¿™å¯¹äºå†…å®¹ä¸°å¯Œçš„ç½‘ç«™ï¼ˆå¦‚æ–‡æ¡£ã€åšå®¢å’Œè¥é”€é¡µé¢ï¼‰å°¤å…¶æœ‰ç”¨ã€‚é™æ€æ–‡ä»¶åœ¨è¿è¡Œæ—¶æ— éœ€æœåŠ¡å™¨å¤„ç†å³å¯ç›´æ¥æä¾›ã€‚

å¯ä»¥é€šè¿‡ routes é€‰é¡¹ä¸ºç‰¹å®šè·¯ç”±é…ç½®é¢„æ¸²æŸ“ã€‚

```tsx
import { defineConfig } from "@solidjs/start/config";

export default defineConfig({
  server: {
    prerender: {
      routes: ["/", "/about"]
    }
  }
});
```

æˆ–è€…ï¼Œè¦å¯¹æ‰€æœ‰è·¯ç”±è¿›è¡Œé¢„æ¸²æŸ“ï¼Œå¯ä»¥å°† crawlLinks é€‰é¡¹è®¾ç½®ä¸º trueã€‚

```tsx
import { defineConfig } from "@solidjs/start/config";

export default defineConfig({
  server: {
    prerender: {
      crawlLinks: true
    }
  }
});
```

## é™æ€èµ„æº

åœ¨ SolidStart ä¸­ï¼Œæœ‰ä¸¤ç§æ–¹å¼å°†é™æ€èµ„æºå¯¼å…¥åˆ°é¡¹ç›®ä¸­ï¼š

1. ä½¿ç”¨ public ç›®å½•
2. ä½¿ç”¨æ¨¡å—å¯¼å…¥ï¼ˆimportsï¼‰

### å…¬å…±ç›®å½•

ä¸°å¯Œçš„ Web åº”ç”¨ä¼šä½¿ç”¨å„ç§èµ„æºæ¥æ„å»ºè§†è§‰æ•ˆæœã€‚åœ¨ SolidStart ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ /public ç›®å½•å­˜æ”¾é™æ€èµ„æºã€‚è¿™äº›èµ„æºä¼šä»¥ç›¸å¯¹äº public ç›®å½•çš„åŸå§‹è·¯å¾„è¿›è¡Œè®¿é—®ï¼š

```
|-- public
|   favicon.ico                   ->  /favicon.ico
|   |-- images
|   |   |-- logo.png              ->  /images/logo.png
|   |   |-- background.png        ->  /images/background.png
|   |-- models
|   |   |-- player.gltf           ->  /models/player.gltf
|   |-- documents
|   |   |-- report.pdf            ->  /documents/report.pdf
```

å¦‚æœæƒ³å¼•ç”¨ public ç›®å½•ä¸­çš„èµ„æºï¼Œå¯ä»¥ä½¿ç”¨è¯¥èµ„æºçš„ç»å¯¹è·¯å¾„ï¼š

```tsx
export default function About() {
  return (
    <>
      <h1>About</h1>
      <img src="/images/logo.png" alt="Solid logo" />
    </>
  );
}
```

è¿™ç§æ–¹å¼éå¸¸é€‚åˆå¸Œæœ›å¯¹é™æ€èµ„æºä½¿ç”¨å¯è¯»ä¸”ç¨³å®šçš„å¼•ç”¨åœºæ™¯ã€‚å¸¸è§ç”¨é€”åŒ…æ‹¬ï¼š

- æ–‡æ¡£ï¼ˆdocumentsï¼‰
- Service Worker
- å›¾ç‰‡ã€éŸ³é¢‘å’Œè§†é¢‘ï¼ˆimages, audio, videoï¼‰
- Manifest æ–‡ä»¶
- å…ƒæ•°æ®æ–‡ä»¶ï¼ˆå¦‚ robots.txtã€sitemapsï¼‰
- ç½‘ç«™å›¾æ ‡ï¼ˆfaviconï¼‰

### å¯¼å…¥èµ„æº

Vite æä¾›äº†ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥å°†èµ„æºç›´æ¥å¯¼å…¥åˆ° Solid ç»„ä»¶ä¸­ï¼š

```tsx
import logo from "./solid.png";

export default function About() {
  return (
    <>
      <h1>About</h1>
      <img src={logo} alt="Solid logo" />
      // Renders
      <img src="/assets/solid.2d8efhg.png" alt="Solid logo" />
    </>
  );
}
```

ä½¿ç”¨æ¨¡å—å¯¼å…¥æ—¶ï¼ŒVite ä¼šç”Ÿæˆå¸¦å“ˆå¸Œçš„æ–‡ä»¶åã€‚ä¾‹å¦‚ï¼Œsolid.png ä¼šå˜ä¸º solid.2d8efhg.pngã€‚

### å…¬å…±ç›®å½• vs æ¨¡å—å¯¼å…¥

public ç›®å½•å’Œæ¨¡å—å¯¼å…¥éƒ½æ˜¯åœ¨é¡¹ç›®ä¸­åŒ…å«é™æ€èµ„æºçš„æœ‰æ•ˆæ–¹å¼ã€‚é€‰æ‹©å“ªç§æ–¹å¼å–å†³äºå…·ä½“çš„ä½¿ç”¨åœºæ™¯ï¼š

- å…¬å…±ç›®å½•ï¼šé€‚åˆéœ€è¦åŠ¨æ€æ›´æ–°èµ„æºçš„åœºæ™¯ã€‚å¯ä»¥å®Œå…¨æ§åˆ¶èµ„æºçš„ URL è·¯å¾„ï¼Œå³ä½¿èµ„æºæ›´æ–°ï¼Œé“¾æ¥ä¹Ÿä¿æŒä¸å˜ã€‚
- æ¨¡å—å¯¼å…¥ï¼šæ–‡ä»¶åä¼šè¢«å“ˆå¸Œï¼Œå› æ­¤ä¸å¯é¢„æµ‹ã€‚è¿™å¯¹äºç¼“å­˜æ›´æ–°ï¼ˆcache bustingï¼‰æœ‰åˆ©ï¼Œä½†å¦‚æœéœ€è¦å°†èµ„æºé“¾æ¥åˆ†äº«ç»™ä»–äººï¼Œåˆ™å¯èƒ½ä¸æ–¹ä¾¿ã€‚

# é«˜çº§

## ä¸­é—´ä»¶

ä¸­é—´ä»¶ç”¨äºæ‹¦æˆª HTTP è¯·æ±‚å’Œå“åº”ï¼Œä»¥æ‰§è¡Œèº«ä»½éªŒè¯ã€é‡å®šå‘ã€æ—¥å¿—è®°å½•ç­‰æ“ä½œã€‚å®ƒè¿˜å¯ä»¥é€šè¿‡ event.locals å¯¹è±¡åœ¨åº”ç”¨ä¸­å…±äº«è¯·æ±‚èŒƒå›´çš„æ•°æ®ã€‚

### å¸¸è§ç”¨ä¾‹

ä¸­é—´ä»¶çš„ä¸€äº›å¸¸è§ç”¨ä¾‹åŒ…æ‹¬ï¼š

- è¯·æ±‚å’Œå“åº”å¤´ç®¡ç†ï¼šå¯ä»¥ä¿®æ”¹å¤´éƒ¨ä»¥æ§åˆ¶ç¼“å­˜ï¼ˆå¦‚ Cache-Controlï¼‰ã€æé«˜å®‰å…¨æ€§ï¼ˆå¦‚ Content-Security-Policyï¼‰ï¼Œæˆ–æ ¹æ®è¯·æ±‚ç‰¹æ€§å®ç°è‡ªå®šä¹‰è¡Œä¸ºã€‚
- å…¨å±€æ•°æ®å…±äº«ï¼ševent.locals å¯¹è±¡å…è®¸åœ¨ä¸­é—´ä»¶å’Œä»»ä½•æœåŠ¡å™¨ç«¯ä¸Šä¸‹æ–‡ï¼ˆå¦‚ API è·¯ç”±ã€ä»…æœåŠ¡å™¨çš„æŸ¥è¯¢/åŠ¨ä½œï¼‰ä¹‹é—´å­˜å‚¨å’Œå…±äº«è¯·æ±‚èŒƒå›´çš„æ•°æ®ï¼Œä¾‹å¦‚ç”¨æˆ·è®¤è¯çŠ¶æ€ã€åŠŸèƒ½æ ‡è®°æˆ–å…¶ä»–è¯·æ±‚ç›¸å…³ä¿¡æ¯ã€‚
- æœåŠ¡å™¨ç«¯é‡å®šå‘ï¼šä¸­é—´ä»¶å¯ä»¥æ ¹æ®è¯·æ±‚å±æ€§ï¼ˆå¦‚è¯­è¨€ç¯å¢ƒã€è®¤è¯çŠ¶æ€æˆ–è‡ªå®šä¹‰æŸ¥è¯¢å‚æ•°ï¼‰é‡å®šå‘ç”¨æˆ·ã€‚
- è¯·æ±‚é¢„å¤„ç†ï¼šå¯ä»¥æ‰§è¡Œè½»é‡çº§çš„é¢„å¤„ç†ä»»åŠ¡ï¼Œä¾‹å¦‚éªŒè¯ä»¤ç‰Œæˆ–è§„èŒƒåŒ–è·¯å¾„ã€‚

### é™åˆ¶

å°½ç®¡ä¸­é—´ä»¶åŠŸèƒ½å¼ºå¤§ï¼Œä½†æŸäº›ä»»åŠ¡æ›´é€‚åˆåœ¨åº”ç”¨çš„å…¶ä»–éƒ¨åˆ†å¤„ç†ï¼Œä»¥ä¿è¯æ€§èƒ½ã€å¯ç»´æŠ¤æ€§å’Œå®‰å…¨æ€§ï¼š

- æˆæƒï¼šä¸­é—´ä»¶å¹¶éåœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½æ‰§è¡Œï¼Œå°¤å…¶æ˜¯åœ¨å®¢æˆ·ç«¯å¯¼èˆªæ—¶ã€‚å› æ­¤ï¼Œä¾èµ–ä¸­é—´ä»¶è¿›è¡Œæˆæƒå¯èƒ½é€ æˆä¸¥é‡å®‰å…¨æ¼æ´ã€‚æˆæƒæ£€æŸ¥åº”å°½é‡é è¿‘æ•°æ®æºæ‰§è¡Œï¼Œä¾‹å¦‚åœ¨ API è·¯ç”±ã€ä»…æœåŠ¡å™¨çš„æŸ¥è¯¢/åŠ¨ä½œæˆ–å…¶ä»–æœåŠ¡å™¨ç«¯å·¥å…·ä¸­ã€‚
- é‡è®¡ç®—æˆ–é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼šä¸­é—´ä»¶åº”ä¿æŒè½»é‡ä¸”å¿«é€Ÿæ‰§è¡Œï¼Œä»¥é¿å…å½±å“æ€§èƒ½ã€‚CPU å¯†é›†å‹ä»»åŠ¡ã€é•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹æˆ–é˜»å¡æ“ä½œï¼ˆå¦‚å¤æ‚è®¡ç®—ã€å¤–éƒ¨ API è°ƒç”¨ï¼‰æœ€å¥½ç”±ä¸“ç”¨è·¯ç”±å¤„ç†å™¨ã€æœåŠ¡å™¨ç«¯å·¥å…·æˆ–åå°ä»»åŠ¡å¤„ç†ã€‚
- æ•°æ®åº“æ“ä½œï¼šåœ¨ä¸­é—´ä»¶ä¸­ç›´æ¥è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢å¯èƒ½å¯¼è‡´æ€§èƒ½ç“¶é¢ˆï¼Œå¹¶å¢åŠ åº”ç”¨çš„ç»´æŠ¤éš¾åº¦ã€‚æ•°æ®åº“äº¤äº’åº”ç”±æœåŠ¡å™¨ç«¯å·¥å…·æˆ–è·¯ç”±å¤„ç†å™¨è´Ÿè´£ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç®¡ç†æ•°æ®åº“è¿æ¥å¹¶å¤„ç†æ½œåœ¨é”™è¯¯ã€‚

### åŸºæœ¬ç”¨æ³•

ä¸­é—´ä»¶é€šè¿‡åœ¨ä¸“ç”¨æ–‡ä»¶ï¼ˆä¾‹å¦‚ src/middleware/index.tsï¼‰ä¸­å¯¼å‡ºé…ç½®å¯¹è±¡æ¥é…ç½®ã€‚

è¯¥å¯¹è±¡é€šè¿‡ createMiddleware å‡½æ•°åˆ›å»ºï¼Œç”¨äºå®šä¹‰ä¸­é—´ä»¶å‡½æ•°åœ¨è¯·æ±‚ç”Ÿå‘½å‘¨æœŸä¸­çš„æ‰§è¡Œæ—¶æœºã€‚

```tsx
import { createMiddleware } from "@solidjs/start/middleware";

export default createMiddleware({
  onRequest: (event) => {
    console.log("Request received:", event.request.url);

    event.locals.startTime = Date.now();
  },
  onBeforeResponse: (event) => {
    const endTime = Date.now();
    const duration = endTime - event.locals.startTime;
    console.log(`Request took ${duration}ms`);
  },
});
```

ä¸ºäº†è®© SolidStart è¯†åˆ«è¯¥é…ç½®å¯¹è±¡ï¼Œéœ€è¦åœ¨ app.config.ts ä¸­å£°æ˜æ–‡ä»¶è·¯å¾„ï¼š

```tsx
import { defineConfig } from "@solidjs/start/config";

export default defineConfig({
  middleware: "src/middleware/index.ts",
});

```

### ç”Ÿå‘½å‘¨æœŸäº‹ä»¶

ä¸­é—´ä»¶å‡½æ•°åœ¨è¯·æ±‚ç”Ÿå‘½å‘¨æœŸçš„ç‰¹å®šæ—¶åˆ»æ‰§è¡Œï¼Œä¸»è¦ä½¿ç”¨ä¸¤ä¸ªå…³é”®äº‹ä»¶ï¼šonRequest å’Œ onBeforeResponseã€‚

#### onRequest

onRequest äº‹ä»¶åœ¨è¯·æ±‚ç”Ÿå‘½å‘¨æœŸçš„å¼€å§‹è§¦å‘ï¼Œåœ¨è·¯ç”±å¤„ç†å™¨å¤„ç†è¯·æ±‚ä¹‹å‰æ‰§è¡Œã€‚é€‚åˆåœ¨æ­¤é˜¶æ®µè¿›è¡Œï¼š

- åœ¨ event.locals ä¸­å­˜å‚¨è¯·æ±‚èŒƒå›´çš„æ•°æ®ï¼Œä»¥ä¾¿åç»­ä¸­é—´ä»¶æˆ–è·¯ç”±å¤„ç†å™¨ä½¿ç”¨ã€‚
- è®¾ç½®æˆ–ä¿®æ”¹è¯·æ±‚å¤´ã€‚
- æå‰æ‰§è¡Œé‡å®šå‘ã€‚

#### onBeforeResponse

onBeforeResponse äº‹ä»¶åœ¨è·¯ç”±å¤„ç†å™¨å¤„ç†è¯·æ±‚åã€å“åº”å‘é€åˆ°å®¢æˆ·ç«¯ä¹‹å‰è§¦å‘ã€‚é€‚åˆåœ¨æ­¤é˜¶æ®µè¿›è¡Œï¼š

- è®¾ç½®æˆ–ä¿®æ”¹å“åº”å¤´ã€‚
- è®°å½•å“åº”æŒ‡æ ‡æˆ–æ‰§è¡Œå…¶ä»–åå¤„ç†ä»»åŠ¡ã€‚
- ä¿®æ”¹å“åº”ä½“ã€‚

### Locals

åœ¨ Web åº”ç”¨ä¸­ï¼Œç»å¸¸éœ€è¦åœ¨æœåŠ¡å™¨ç«¯çš„ä¸åŒéƒ¨åˆ†å…±äº«è¯·æ±‚ç‰¹å®šçš„æ•°æ®ã€‚è¿™äº›æ•°æ®å¯èƒ½åŒ…æ‹¬ç”¨æˆ·è®¤è¯çŠ¶æ€ã€ç”¨äºè°ƒè¯•çš„è¿½è¸ª IDï¼Œæˆ–å®¢æˆ·ç«¯å…ƒæ•°æ®ï¼ˆå¦‚ç”¨æˆ·ä»£ç†ã€åœ°ç†ä½ç½®ï¼‰ã€‚

event.locals æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œå¯å­˜å‚¨ä»»æ„ JavaScript å€¼ã€‚å®ƒæä¾›äº†ä¸€ä¸ªä¸´æ—¶çš„ã€è¯·æ±‚èŒƒå›´çš„å­˜å‚¨å±‚ï¼š

- æ•°æ®ä»…åœ¨å•ä¸ª HTTP è¯·æ±‚å¤„ç†æœŸé—´å¯ç”¨ã€‚
- è¯·æ±‚å¤„ç†ç»“æŸåä¼šè‡ªåŠ¨æ¸…é™¤ã€‚

```tsx
import { createMiddleware } from "@solidjs/start/middleware";

export default createMiddleware({
  onRequest: (event) => {
    event.locals.user = {
      name: "John Wick",
    };
    event.locals.sayHello = () => {
      return "Hello, " + event.locals.user.name;
    };
  },
});
```

åœ¨ä¸­é—´ä»¶ä¸­ï¼Œå¯ä»¥ç›´æ¥è®¿é—®å’Œä¿®æ”¹ event.localsã€‚

åœ¨å…¶ä»–æœåŠ¡å™¨ç«¯ä¸Šä¸‹æ–‡ä¸­ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ getRequestEvent å‡½æ•°æ¥è®¿é—® event.locals å¯¹è±¡ã€‚

```tsx
import { getRequestEvent } from "solid-js/web";
import { query, createAsync } from "@solidjs/router";

const getUser = query(async () => {
  "use server";
  const event = getRequestEvent();
  return {
    name: event?.locals?.user?.name,
    greeting: event?.locals?.sayHello(),
  };
}, "user");

export default function Page() {
  const user = createAsync(() => getUser());

  return (
    <div>
      <p>Name: {user()?.name}</p>
      <button onClick={() => alert(user()?.greeting)}>Say Hello</button>
    </div>
  );
}
```

### Headers

è¯·æ±‚å’Œå“åº”å¤´å¯ä»¥é€šè¿‡ event.request.headers å’Œ event.response.headers è®¿é—®å’Œä¿®æ”¹ã€‚

å®ƒä»¬éµå¾ªæ ‡å‡†çš„ Web API Headers æ¥å£ï¼Œæä¾›å†…ç½®æ–¹æ³•ç”¨äºè¯»å–å’Œæ›´æ–°å¤´éƒ¨ä¿¡æ¯ã€‚

```tsx
import { createMiddleware } from "@solidjs/start/middleware";

export default createMiddleware({
  onRequest: (event) => {
    // Reading client metadata for later use
    const userAgent = event.request.headers.get("user-agent");
    // Adding custom headers to request/response
    event.request.headers.set("x-custom-request-header", "hello");
    event.response.headers.set("x-custom-response-header1", "hello");
  },
  onBeforeResponse: (event) => {
    // Finalizing response headers before sending to client
    event.response.headers.set("x-custom-response-header2", "hello");
  },
});
```

åœ¨ onRequest ä¸­è®¾ç½®çš„å¤´éƒ¨ä¼šåœ¨è·¯ç”±å¤„ç†å™¨å¤„ç†è¯·æ±‚ä¹‹å‰ç”Ÿæ•ˆï¼Œè¿™å…è®¸åç»­çš„ä¸­é—´ä»¶æˆ–è·¯ç”±å¤„ç†å™¨è¦†ç›–å®ƒä»¬ã€‚

åœ¨ onBeforeResponse ä¸­è®¾ç½®çš„å¤´éƒ¨ä¼šåœ¨è·¯ç”±å¤„ç†å™¨å¤„ç†è¯·æ±‚ä¹‹åç”Ÿæ•ˆï¼Œå¹¶æœ€ç»ˆå‘é€ç»™å®¢æˆ·ç«¯ã€‚

### Cookies

HTTP Cookie å¯é€šè¿‡è¯·æ±‚å¤´ Cookie å’Œå“åº”å¤´ Set-Cookie è®¿é—®ã€‚

è™½ç„¶å¯ä»¥ç›´æ¥æ“ä½œè¿™äº›å¤´éƒ¨ï¼Œä½† SolidStart æ‰€ä¾èµ–çš„æœåŠ¡å™¨å·¥å…· Vinxi æä¾›äº†è¾…åŠ©æ–¹æ³•æ¥ç®€åŒ– Cookie ç®¡ç†ã€‚

æ›´å¤šä¿¡æ¯è¯·å‚é˜… Vinxi çš„ Cookies æ–‡æ¡£ã€‚

```tsx
import { createMiddleware } from "@solidjs/start/middleware";
import { getCookie, setCookie } from "vinxi/http";

export default createMiddleware({
  onRequest: (event) => {
    // Reading a cookie
    const theme = getCookie(event.nativeEvent, "theme");

    // Setting a secure session cookie with expiration
    setCookie(event.nativeEvent, "session", "abc123", {
      httpOnly: true,
      secure: true,
      maxAge: 60 * 60 * 24, // 1 day
    });
  },
});
```

### è‡ªå®šä¹‰å“åº”

ä»ä¸­é—´ä»¶å‡½æ•°è¿”å›ä¸€ä¸ªå€¼ä¼šç«‹å³ç»ˆæ­¢è¯·æ±‚å¤„ç†æµç¨‹ï¼Œå¹¶å°†è¯¥è¿”å›å€¼ä½œä¸ºå“åº”å‘é€ç»™å®¢æˆ·ç«¯ã€‚è¿™æ„å‘³ç€åç»­çš„ä¸­é—´ä»¶å‡½æ•°æˆ–è·¯ç”±å¤„ç†å™¨å°†ä¸ä¼šå†è¢«æ‰§è¡Œã€‚

```tsx
import { createMiddleware } from "@solidjs/start/middleware";

export default createMiddleware({
  onRequest: () => {
    return new Response("Unauthorized", { status: 401 });
  },
});
```

ä¸­é—´ä»¶å‡½æ•°åªèƒ½è¿”å› Response å¯¹è±¡ã€‚è¿”å›ä»»ä½•å…¶ä»–ç±»å‹çš„å€¼éƒ½ä¼šå¯¼è‡´é”™è¯¯ã€‚

#### é‡å®šå‘

Solid Router æä¾›äº† redirect è¾…åŠ©å‡½æ•°ï¼Œç”¨äºç®€åŒ–åˆ›å»ºé‡å®šå‘å“åº”çš„æ“ä½œã€‚

```tsx
import { createMiddleware } from "@solidjs/start/middleware";
import { redirect } from "@solidjs/router";

const REDIRECT_MAP: Record<string, string> = {
  "/signup": "/auth/signup",
  "/login": "/auth/login",
};

export default createMiddleware({
  onRequest: (event) => {
    const { pathname } = new URL(event.request.url);

    // Redirecting legacy routes permanently to new paths
    if (pathname in REDIRECT_MAP) {
      return redirect(REDIRECT_MAP[pathname], 301);
    }
  },
});
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä¼šæ£€æŸ¥è¯·æ±‚çš„è·¯å¾„ï¼Œå¦‚æœåŒ¹é…é¢„å®šä¹‰è·¯å¾„ï¼Œåˆ™è¿”å›é‡å®šå‘å“åº”ã€‚301 çŠ¶æ€ç è¡¨ç¤ºæ°¸ä¹…é‡å®šå‘ã€‚æ ¹æ®éœ€è¦ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–é‡å®šå‘çŠ¶æ€ç ï¼Œä¾‹å¦‚ 302 æˆ– 307ã€‚

#### JSON å“åº”

Solid Router æä¾›äº† json è¾…åŠ©å‡½æ•°ï¼Œç”¨äºç®€åŒ–å‘é€è‡ªå®šä¹‰ JSON å“åº”çš„æ“ä½œã€‚

```tsx
import { createMiddleware } from "@solidjs/start/middleware";
import { json } from "@solidjs/router";

export default createMiddleware({
  onRequest: (event) => {
    // Rejecting unauthorized API requests with a JSON error
    const authHeader = event.request.headers.get("Authorization");
    if (!authHeader) {
      return json({ error: "Unauthorized" }, { status: 401 });
    }
  },
});
```

### é“¾å¼ä¸­é—´ä»¶

åœ¨ createMiddleware ä¸­ï¼ŒonRequest å’Œ onBeforeResponse å¯ä»¥æ¥å—å•ä¸ªå‡½æ•°æˆ–ä¸­é—´ä»¶å‡½æ•°æ•°ç»„ã€‚

å½“æä¾›æ•°ç»„æ—¶ï¼Œè¿™äº›å‡½æ•°ä¼šåœ¨åŒä¸€ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ä¸­æŒ‰é¡ºåºæ‰§è¡Œã€‚

è¿™ä½¿å¾—å¯ä»¥ç»„åˆå¤šä¸ªå°å‹ã€ä¸“æ³¨çš„ä¸­é—´ä»¶å‡½æ•°ï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰é€»è¾‘æ”¾åœ¨ä¸€ä¸ªåºå¤§çš„ä¸­é—´ä»¶å‡½æ•°ä¸­å¤„ç†ã€‚

```tsx
import { createMiddleware } from "@solidjs/start/middleware";
import { type FetchEvent } from "@solidjs/start/server";

function middleware1(event: FetchEvent) {
  event.request.headers.set("x-custom-header1", "hello-from-middleware1");
}

function middleware2(event: FetchEvent) {
  event.request.headers.set("x-custom-header2", "hello-from-middleware2");
}

export default createMiddleware({
  onRequest: [middleware1, middleware2],
});

```

æ•°ç»„ä¸­ä¸­é—´ä»¶å‡½æ•°çš„é¡ºåºå†³å®šäº†å®ƒä»¬çš„æ‰§è¡Œé¡ºåºã€‚

æœ‰ä¾èµ–å…³ç³»çš„ä¸­é—´ä»¶åº”æ”¾åœ¨å…¶ä¾èµ–çš„ä¸­é—´ä»¶ä¹‹åã€‚ä¾‹å¦‚ï¼Œèº«ä»½éªŒè¯ä¸­é—´ä»¶é€šå¸¸åº”åœ¨æ—¥å¿—è®°å½•ä¸­é—´ä»¶ä¹‹å‰è¿è¡Œã€‚

## ä¼šè¯

ä¼šè¯ä½¿ Web åº”ç”¨èƒ½å¤Ÿåœ¨ç”¨æˆ·è¯·æ±‚ä¹‹é—´ä¿æŒçŠ¶æ€ã€‚

ç”±äº HTTP æ˜¯æ— çŠ¶æ€çš„ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹å¤„ç†çš„ã€‚ä¼šè¯é€šè¿‡è®©æœåŠ¡å™¨è¯†åˆ«æ¥è‡ªåŒä¸€ç”¨æˆ·çš„å¤šä¸ªè¯·æ±‚æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Œè¿™å¯¹äºè·Ÿè¸ªèº«ä»½éªŒè¯çŠ¶æ€å’Œç”¨æˆ·åå¥½éå¸¸æœ‰ç”¨ã€‚

### ä¼šè¯çš„å·¥ä½œåŸç†

ä¸€ä¸ªä¼šè¯é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

1. ä¼šè¯åˆ›å»ºï¼šå½“éœ€è¦è·Ÿè¸ªç”¨æˆ·ï¼ˆä¾‹å¦‚ç™»å½•æˆ–é¦–æ¬¡è®¿é—®æ—¶ï¼‰ï¼ŒæœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ªä¼šè¯ã€‚æ­¤è¿‡ç¨‹åŒ…æ‹¬ç”Ÿæˆå”¯ä¸€çš„ä¼šè¯ IDï¼Œå¹¶å°†ä¼šè¯æ•°æ®åŠ å¯†ç­¾ååå­˜å‚¨åœ¨ Cookie ä¸­ã€‚
2. ä¼šè¯ Cookie ä¼ è¾“ï¼šæœåŠ¡å™¨é€šè¿‡ Set-Cookie HTTP å¤´å‘é€ä¼šè¯ Cookieï¼ŒæŒ‡ç¤ºæµè§ˆå™¨å­˜å‚¨è¯¥ Cookieã€‚
3. åç»­è¯·æ±‚ï¼šæµè§ˆå™¨åœ¨åç»­å‘æœåŠ¡å™¨å‘é€çš„è¯·æ±‚ä¸­ï¼Œä¼šè‡ªåŠ¨åœ¨ Cookie HTTP å¤´ä¸­æºå¸¦è¯¥ä¼šè¯ Cookieã€‚
4. ä¼šè¯æ£€ç´¢ä¸æ•°æ®è®¿é—®ï¼šæ¯æ¬¡è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨æ£€æŸ¥ä¼šè¯ Cookieï¼Œå¦‚æœå­˜åœ¨åˆ™æ£€ç´¢ä¼šè¯æ•°æ®ï¼Œå¹¶è§£å¯†ã€éªŒè¯ç­¾åï¼Œä»¥ä¾¿åº”ç”¨è®¿é—®å’Œä½¿ç”¨è¿™äº›æ•°æ®ã€‚
5. ä¼šè¯è¿‡æœŸä¸é”€æ¯ï¼šä¼šè¯é€šå¸¸ä¼šåœ¨ä¸€å®šæ—¶é—´åè¿‡æœŸæˆ–ç”¨æˆ·ç™»å‡ºæ—¶é”€æ¯ï¼Œä¼šé€šè¿‡è®¾ç½® Cookie çš„ Max-Age å±æ€§æˆ–å‘é€å¸¦æœ‰è¿‡æœŸæ—¥æœŸçš„ Set-Cookie å¤´æ¥å®Œæˆã€‚

> ä»¥ä¸Šå¤§å¤šæ•°æ­¥éª¤é€šå¸¸ç”±ä¼šè¯è¾…åŠ©å·¥å…·ï¼ˆsession helpersï¼‰è‡ªåŠ¨ç®¡ç†ã€‚

### æ•°æ®åº“å­˜å‚¨ä¼šè¯

å¯¹äºå¤§å‹åº”ç”¨æˆ–éœ€è¦æ›´é«˜çº§ä¼šè¯ç®¡ç†çš„åœºæ™¯ï¼Œå¯ä»¥å°†ä¼šè¯æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚å…¶å·¥ä½œæ–¹å¼ä¸åŸºäº Cookie çš„æ–¹æ³•ç±»ä¼¼ï¼Œä½†æœ‰å‡ ä¸ªå…³é”®åŒºåˆ«ï¼š

1. ä¼šè¯æ•°æ®å­˜å‚¨ï¼šä¼šè¯æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸ä¼šè¯ ID å…³è”ã€‚
2. Cookie å†…å®¹ï¼šCookie ä¸­åªå­˜å‚¨ä¼šè¯ IDï¼Œè€Œä¸å­˜å‚¨å®Œæ•´çš„ä¼šè¯æ•°æ®ã€‚
3. æ•°æ®æ£€ç´¢ï¼šæœåŠ¡å™¨é€šè¿‡ä¼šè¯ ID ä»æ•°æ®åº“ä¸­æ£€ç´¢ä¼šè¯æ•°æ®ï¼Œè€Œä¸æ˜¯ç›´æ¥ä» Cookie è·å–ã€‚
4. ä¼šè¯è¿‡æœŸï¼šå½“ä¼šè¯è¿‡æœŸæ—¶ï¼Œä¸ä»…åˆ é™¤ Cookieï¼ŒåŒæ—¶è¿˜éœ€è¦åˆ é™¤æ•°æ®åº“ä¸­å¯¹åº”çš„ä¼šè¯è®°å½•ã€‚

> æ³¨æ„ï¼šSolidStart ä¸ä¼šè‡ªåŠ¨å¤„ç†æ•°æ®åº“äº¤äº’ï¼Œä½ éœ€è¦è‡ªè¡Œå®ç°æ•°æ®åº“å­˜å‚¨å’Œè¯»å–é€»è¾‘ã€‚

### ä¼šè¯åŠ©æ‰‹

Vinxiï¼ˆSolidStart çš„åº•å±‚æœåŠ¡å·¥å…·åŒ…ï¼‰æä¾›äº†ä¸€äº›ä¼šè¯åŠ©æ‰‹å‡½æ•°ï¼Œç”¨äºç®€åŒ–ä¼šè¯ç®¡ç†ã€‚ä¸»è¦åŒ…æ‹¬ï¼š

- useSessionï¼šåˆå§‹åŒ–ä¸€ä¸ªä¼šè¯æˆ–è·å–ç°æœ‰ä¼šè¯ï¼Œè¿”å›ä¼šè¯å¯¹è±¡ã€‚
- getSessionï¼šè·å–å½“å‰ä¼šè¯æˆ–åˆå§‹åŒ–ä¸€ä¸ªæ–°ä¼šè¯ã€‚
- updateSessionï¼šæ›´æ–°å½“å‰ä¼šè¯ä¸­çš„æ•°æ®ã€‚
- clearSessionï¼šæ¸…é™¤å½“å‰ä¼šè¯ã€‚

> è¿™äº›åŠ©æ‰‹ä»…åœ¨æœåŠ¡å™¨ç«¯ä¸Šä¸‹æ–‡ä¸­å¯ç”¨ï¼Œä¾‹å¦‚åœ¨æœåŠ¡å™¨å‡½æ•°æˆ– API è·¯ç”±ä¸­ã€‚è¿™æ˜¯å› ä¸ºä¼šè¯ç®¡ç†éœ€è¦è®¿é—®æœåŠ¡å™¨èµ„æºï¼Œä»¥åŠè®¾ç½®å’Œè·å– HTTP å¤´çš„èƒ½åŠ›ã€‚

### åˆ›å»ºä¼šè¯

**useSession** æ˜¯åˆ›å»ºå’Œç®¡ç†ä¼šè¯çš„ä¸»è¦æ–¹æ³•ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå®Œæ•´çš„æ¥å£æ¥æ‰§è¡Œæ‰€æœ‰ä¼šè¯æ“ä½œï¼ŒåŒ…æ‹¬åˆå§‹åŒ–ã€è¯»å–ã€æ›´æ–°å’Œæ¸…é™¤ä¼šè¯æ•°æ®ã€‚

```tsx
import { useSession } from "vinxi/http";

type SessionData = {
  theme: "light" | "dark";
};

export async function useThemeSession() {
  "use server";
  const session = await useSession<SessionData>({
    password: process.env.SESSION_SECRET as string,
    name: "theme",
  });

  if (!session.data.theme) {
    await session.update({
      theme: "light",
    });
  }

  return session;
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒuseThemeSession æœåŠ¡å™¨å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªä¼šè¯ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·çš„ä¸»é¢˜åå¥½è®¾ç½®ã€‚

useSession éœ€è¦ä¸€ä¸ªå¼ºå¯†ç æ¥åŠ å¯†å¹¶ç­¾ç½²ä¼šè¯ Cookieã€‚è¯¥å¯†ç é•¿åº¦å¿…é¡»è‡³å°‘ä¸º 32 ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸”åº”ä¿æŒé«˜åº¦å®‰å…¨ã€‚å¼ºçƒˆå»ºè®®å°†æ­¤å¯†ç å­˜å‚¨åœ¨ç§æœ‰ç¯å¢ƒå˜é‡ä¸­ï¼ˆå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼‰ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç åœ¨æºä»£ç ä¸­ã€‚

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆå¯†ç ï¼š

```shell
openssl rand -base64 32
```

useSession ä¼šå‘å½“å‰çš„æœåŠ¡å™¨å“åº”æ·»åŠ ä¸€ä¸ª Set-Cookie HTTP å¤´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookie åç§°ä¸º h3ï¼Œä½†å¯ä»¥é€šè¿‡ name é€‰é¡¹è‡ªå®šä¹‰ï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºã€‚

### è·å–ä¼šè¯æ•°æ®

useSession è¾…åŠ©å‡½æ•°é€šè¿‡ data å±æ€§æä¾›å¯¹å½“å‰è¯·æ±‚ä¼šè¯æ•°æ®çš„è®¿é—®ã€‚

```tsx
export async function getThemeSession() {
  "use server";
  const session = await useThemeSession();

  return session.data.theme;
}
```

### æ›´æ–°ä¼šè¯æ•°æ®

useSession è¾…åŠ©å‡½æ•°æä¾› update æ–¹æ³•ï¼Œç”¨äºæ›´æ–°å½“å‰è¯·æ±‚çš„ä¼šè¯æ•°æ®ã€‚

```tsx
export async function updateThemeSession(data: SessionData) {
  "use server";
  const session = await useThemeSession();
  await session.update(data);
}
```

### æ¸…é™¤ä¼šè¯æ•°æ®

useSession è¾…åŠ©å‡½æ•°æä¾› clear æ–¹æ³•ï¼Œç”¨äºæ¸…é™¤å½“å‰è¯·æ±‚çš„ä¼šè¯æ•°æ®ã€‚

```tsx
export async function clearThemeSession() {
  "use server";
  const session = await useThemeSession();
  await session.clear();
}
```

## è¯·æ±‚äº‹ä»¶

åœ¨ SolidStart ä¸­ï¼Œè¯·æ±‚äº‹ä»¶å¯ä»¥é€šè¿‡ getRequestEventï¼ˆæ¥è‡ª @solidjs/webï¼‰è·å–ã€‚è¿™äº›è¯·æ±‚äº‹ä»¶å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯çš„ä»»æ„ä½ç½®å‘ç”Ÿã€‚

### Locals

SolidStart ä½¿ç”¨ event.locals æ¥ä¼ é€’å±€éƒ¨ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶å…±äº«æ•°æ®ã€‚

åœ¨å‘ event.locals æ·»åŠ å­—æ®µæ—¶ï¼Œå¯ä»¥ä¸ºè¿™äº›å­—æ®µæŒ‡å®šç±»å‹ï¼š

```tsx
/// <reference types="@solidjs/start/env" />
declare module App {
  interface RequestEventLocals {
    /**
     * Declare your getRequestEvent().locals here
     */
  }
}

```

### nativeEvent

æœ‰æ—¶ä»ç„¶éœ€è¦è®¿é—®åº•å±‚çš„ Vinxi äº‹ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡ .nativeEvent å±æ€§è·å–ï¼Œå®ƒæŒ‡å‘åº•å±‚ä½¿ç”¨çš„ H3Eventï¼Œå¹¶å¯ä»¥ä¼ é€’ç»™ç”Ÿæ€ç³»ç»Ÿä¸­å¯ç”¨çš„è¾…åŠ©å‡½æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒVinxi çš„ HTTP è¾…åŠ©å‡½æ•°ä¸ä¼šè¿›è¡Œ tree-shakingï¼Œå› æ­¤åªèƒ½åœ¨ä¸åŒ…å«å®¢æˆ·ç«¯æˆ–åŒæ„ä»£ç çš„æ–‡ä»¶ä¸­å¯¼å…¥å®ƒä»¬ã€‚

å¦å¤–ï¼Œè®¸å¤šè¿™äº›äº‹ä»¶æ”¯æŒå¼‚æ­¥æœ¬åœ°å­˜å‚¨ï¼ˆAsync Local Storageï¼‰ï¼Œå› æ­¤åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¸éœ€è¦ç›´æ¥è®¿é—® nativeEventã€‚

## è¿”å›å“åº”

åœ¨ SolidStart ä¸­ï¼Œå¯ä»¥ä»æœåŠ¡å™¨å‡½æ•°è¿”å›ä¸€ä¸ª Response å¯¹è±¡ã€‚solid-router èƒ½å¤Ÿé€šè¿‡å…¶ query å’Œ action API å¤„ç†ç‰¹å®šç±»å‹çš„å“åº”ã€‚

å¯¹äº TypeScriptï¼Œå½“ä½¿ç”¨ solid-router çš„ redirectã€reload æˆ– json è¾…åŠ©å‡½æ•°è¿”å›å“åº”æ—¶ï¼Œè¿™äº›æ“ä½œä¸ä¼šå½±å“æœåŠ¡å™¨å‡½æ•°çš„è¿”å›å€¼ç±»å‹ã€‚

è™½ç„¶å»ºè®®æ ¹æ®å‡½æ•°ç±»å‹å¯¹é”™è¯¯è¿›è¡Œä¸åŒå¤„ç†ï¼Œä½†ä½ å§‹ç»ˆå¯ä»¥é€‰æ‹©è¿”å›æˆ–æŠ›å‡ºä¸€ä¸ª Response å¯¹è±¡ã€‚

### ç¤ºä¾‹

åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œhello å‡½æ•°å°†è¿”å›ä¸€ä¸ªç±»å‹ä¸º Promise<{ hello: string }> çš„å€¼ï¼š

```tsx
import { json } from "@solidjs/router";
import { GET } from "@solidjs/start";

const hello = GET(async (name: string) => {
  "use server";
  return json(
    { hello: new Promise<string>((r) => setTimeout(() => r(name), 1000)) },
    { headers: { "cache-control": "max-age=60" } }
  );
});
```

ç„¶è€Œï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äº redirect å’Œ reload çš„è¿”å›ç±»å‹ä¸º neverï¼ŒgetUser å‡½æ•°åªèƒ½è¿”å›ç±»å‹ä¸º Promise\<User> çš„å€¼ï¼š

```tsx
export async function getUser() {
  "use server";

  const session = await getSession();
  const userId = session.data.userId;
  if (userId === undefined) return redirect("/login");

  try {
    const user: User = await db.user.findUnique({ where: { id: userId } });
    // throwing can be awkward.
    if (!user) return redirect("/login");
    return user;
  } catch {
    // do stuff
    throw redirect("/login");
  }
}
```

## è®¤è¯

æœåŠ¡å™¨å‡½æ•°å¯ä»¥ç”¨äºä¿æŠ¤æ•æ„Ÿèµ„æºï¼Œä¾‹å¦‚ç”¨æˆ·æ•°æ®ã€‚

```tsx
"use server"

async function getPrivatePosts() {
  const user = await getUser()
  if(!user) {
    return null  // or throw an error
  }

  return db.getPosts({ userId: user.id, private: true })
}
```

getUser å‡½æ•°å¯ä»¥é€šè¿‡ä¼šè¯ï¼ˆsessionsï¼‰æ¥å®ç°ã€‚

### å—ä¿æŠ¤çš„è·¯ç”±

å¯ä»¥é€šè¿‡åœ¨è·å–æ•°æ®æ—¶æ£€æŸ¥ç”¨æˆ·æˆ–ä¼šè¯å¯¹è±¡æ¥ä¿æŠ¤è·¯ç”±ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä½¿ç”¨äº† Solid Routerã€‚

```tsx
const getPrivatePosts = query(async function() {
  "use server"
  const user = await getUser()
  if(!user) {
    throw redirect("/login");
  }

  return db.getPosts({ userId: user.id, private: true })
})

export default function Page() {
  const posts = createAsync(() => getPrivatePosts());
}

```

ä¸€æ—¦ç”¨æˆ·è®¿é—®æ­¤è·¯ç”±ï¼Œè·¯ç”±å™¨å°†å°è¯•è·å– getPrivatePosts æ•°æ®ã€‚å¦‚æœç”¨æˆ·å°šæœªç™»å½•ï¼ŒgetPrivatePosts ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè·¯ç”±å™¨éšåä¼šé‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚

## WebSocket ç«¯ç‚¹

WebSocket ç«¯ç‚¹å¯ä»¥é€šè¿‡åœ¨ Start é…ç½®ä¸­æŒ‡å®šçš„ ws å¤„ç†å™¨æ–‡ä»¶æ¥åŒ…å«ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸ªåŠŸèƒ½åœ¨ Nitro æœåŠ¡å™¨ä¸Šä»å±å®éªŒæ€§ï¼Œå…¶é…ç½®å¯èƒ½ä¼šåœ¨ SolidStart çš„æœªæ¥ç‰ˆæœ¬ä¸­å‘ç”Ÿå˜åŒ–ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚

```tsx
import { defineConfig } from "@solidjs/start/config";

export default defineConfig({
  server: {
    experimental: {
      websocket: true,
    },
  },
}).addRouter({
  name: "ws",
  type: "http",
  handler: "./src/ws.ts",
  target: "server",
  base: "/ws",
});
```

åœ¨ ws æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥å¯¼å‡ºä¸€ä¸ª eventHandler å‡½æ•°æ¥ç®¡ç† WebSocket è¿æ¥å’Œäº‹ä»¶ï¼š

```tsx
import { eventHandler } from "vinxi/http";

export default eventHandler({
  handler() {},
  websocket: {
    async open(peer) {
      console.log("open", peer.id, peer.url);
    },
    async message(peer, msg) {
      const message = msg.text();
      console.log("msg", peer.id, peer.url, message);
    },
    async close(peer, details) {
      console.log("close", peer.id, peer.url);
    },
    async error(peer, error) {
      console.log("error", peer.id, peer.url, error);
    },
  },
});
```

# æŒ‡å—

## å®‰å…¨æ€§

### XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰

Solid ä¼šè‡ªåŠ¨å¯¹ä¼ å…¥ JSX è¡¨è¾¾å¼çš„å€¼è¿›è¡Œè½¬ä¹‰ï¼Œä»¥é™ä½ XSS æ”»å‡»çš„é£é™©ã€‚ç„¶è€Œï¼Œè¿™ç§ä¿æŠ¤ä¸ä¼šåº”ç”¨äº innerHTMLã€‚

ä¸ºäº†ä¿æŠ¤åº”ç”¨å…å— XSS æ”»å‡»ï¼Œåº”æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

- å°½é‡é¿å…ä½¿ç”¨ innerHTMLã€‚å¦‚æœå¿…é¡»ä½¿ç”¨ï¼Œè¯·ç¡®ä¿ä½¿ç”¨åƒ DOMPurify è¿™æ ·çš„åº“å¯¹ç”¨æˆ·æä¾›çš„æ•°æ®è¿›è¡Œæ¸…ç†ã€‚
- éªŒè¯å’Œæ¸…ç†ç”¨æˆ·è¾“å…¥ï¼Œå°¤å…¶æ˜¯åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„è¡¨å•è¾“å…¥ã€‚
- è®¾ç½®å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSP, Content Security Policyï¼‰ã€‚
- å¯¹ \<noscript> å…ƒç´ å†…çš„ç”¨æˆ·æä¾›æ•°æ®ç›¸å…³å±æ€§è¿›è¡Œæ¸…ç†ï¼ŒåŒ…æ‹¬ \<noscript> æœ¬èº«çš„å±æ€§åŠå…¶å­å…ƒç´ ã€‚
- å¼ºçƒˆå»ºè®®é˜…è¯»ã€Šè·¨ç«™è„šæœ¬æ”»å‡»é˜²æŠ¤å¤‡å¿˜å•ã€‹ï¼ˆCross Site Scripting Prevention Cheat Sheetï¼‰ä»¥è·å–æ›´å¤šæŒ‡å¯¼ã€‚

### å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰

è¦é…ç½® Content-Security-Policy HTTP å¤´ï¼Œå¯ä»¥ä½¿ç”¨ä¸­é—´ä»¶å®ç°ã€‚

#### ä½¿ç”¨ nonceï¼ˆæ¨èï¼‰

å¦‚æœå¸Œæœ›ä½¿ç”¨å¸¦ nonce çš„ä¸¥æ ¼ CSPï¼Œå¯æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. **åˆ›å»ºä¸­é—´ä»¶**

   - åœ¨ä¸­é—´ä»¶ä¸­é…ç½® CSP å¤´ã€‚
   - ä½¿ç”¨ onRequest äº‹ä»¶æ³¨å†Œè¯¥ä¸­é—´ä»¶ã€‚

2. **ç”Ÿæˆ nonce**

   - ä½¿ç”¨åŠ å¯†éšæœºå€¼ç”Ÿæˆå™¨ï¼ˆä¾‹å¦‚ Node.js çš„ crypto æ¨¡å—ä¸­çš„ randomBytes å‡½æ•°ï¼‰ç”Ÿæˆ nonceã€‚

3. **å­˜å‚¨ nonce**

   - å°†ç”Ÿæˆçš„ nonce å­˜å‚¨åœ¨ locals å¯¹è±¡ä¸­ï¼Œä»¥ä¾¿åœ¨è¯·æ±‚ç”Ÿå‘½å‘¨æœŸä¸­è®¿é—®ã€‚

4. **åœ¨æœåŠ¡å™¨å…¥å£ä¸­ä½¿ç”¨ nonce**

   - é…ç½® SolidStartï¼Œåœ¨ entry-server.tsx æ–‡ä»¶ä¸­å°† nonce åº”ç”¨äºéœ€è¦çš„æ ‡ç­¾ï¼ˆå¦‚ \<script> æˆ– \<style>ï¼‰ã€‚

> `Middleware`


```tsx
import { createMiddleware } from "@solidjs/start/middleware";
import { randomBytes } from "crypto";

export default createMiddleware({
  onRequest: (event) => {
    const nonce = randomBytes(16).toString("base64");

    event.locals.nonce = nonce;

    const csp = `
      default-src 'self';
      script-src 'nonce-${nonce}' 'strict-dynamic' 'unsafe-eval';
      object-src 'none';
      base-uri 'none';
      frame-ancestors 'none';
      form-action 'self';
    `.replace(/\s+/g, " ");

    event.response.headers.set("Content-Security-Policy", csp);
  },
});
```

> `entry-server.tsx`

```tsx
import { createMiddleware } from "@solidjs/start/middleware";
import { randomBytes } from "crypto";

export default createMiddleware({
  onRequest: (event) => {
    const nonce = randomBytes(16).toString("base64");

    event.locals.nonce = nonce;

    const csp = `
      default-src 'self';
      script-src 'nonce-${nonce}' 'strict-dynamic' 'unsafe-eval';
      object-src 'none';
      base-uri 'none';
      frame-ancestors 'none';
      form-action 'self';
    `.replace(/\s+/g, " ");

    event.response.headers.set("Content-Security-Policy", csp);
  },
});
```

#### ä¸ä½¿ç”¨ nonce çš„ CSP

è¦åœ¨ä¸ä½¿ç”¨ nonce çš„æƒ…å†µä¸‹é…ç½® CSPï¼Œéœ€è¦ä¸€ä¸ªè®¾ç½® CSP å¤´çš„ä¸­é—´ä»¶ï¼Œå¹¶ä¸”åº”åœ¨ onBeforeResponse äº‹ä»¶ä¸­æ³¨å†Œè¿è¡Œã€‚

```tsx
import { createMiddleware } from "@solidjs/start/middleware";

export default createMiddleware({
  onBeforeResponse: (event) => {
    const csp = `
      default-src 'self';
      font-src 'self'  ;
      object-src 'none';
      base-uri 'none';
      frame-ancestors 'none';
      form-action 'self';
    `.replace(/\s+/g, " ");

    event.response.headers.set("Content-Security-Policy", csp);
  },
});

```

### è·¨åŸŸèµ„æºå…±äº« (CORS)

å½“å…¶ä»–åº”ç”¨éœ€è¦è®¿é—® API æ¥å£æ—¶ï¼Œéœ€è¦ä¸€ä¸ªé…ç½® CORS å¤´çš„ä¸­é—´ä»¶ã€‚

```tsx
import { createMiddleware } from "@solidjs/start/middleware";
import { json } from "@solidjs/router";

const TRUSTED_ORIGINS = ["https://my-app.com", "https://another-app.com"];

export default createMiddleware({
  onBeforeResponse: (event) => {
    const { request, response } = event;

    response.headers.append("Vary", "Origin, Access-Control-Request-Method");

    const origin = request.headers.get("Origin");
    const requestUrl = new URL(request.url);
    const isApiRequest = requestUrl && requestUrl.pathname.startsWith("/api");

    if (isApiRequest && origin && TRUSTED_ORIGINS.includes(origin)) {
      // Handle preflight requests.
      if (
        request.method === "OPTIONS" &&
        request.headers.get("Access-Control-Request-Method")
      ) {
        // Preflight requests are standalone, so we immediately send a response.
        return json(null, {
          headers: {
            "Access-Control-Allow-Origin": origin,
            "Access-Control-Allow-Methods": "OPTIONS, POST, PUT, PATCH, DELETE",
            "Access-Control-Allow-Headers": "Authorization, Content-Type",
          },
        });
      }

      // Handle normal requests.
      response.headers.set("Access-Control-Allow-Origin", origin);
    }
  },
});
```

#### è·¨ç«™è¯·æ±‚ä¼ªé€  (CSRF)

ä¸ºäº†é˜²æ­¢ CSRF æ”»å‡»ï¼Œå¯ä»¥ä½¿ç”¨ä¸­é—´ä»¶æ¥é˜»æ­¢ä¸å¯ä¿¡çš„è¯·æ±‚ã€‚

```tsx
import { createMiddleware } from "@solidjs/start/middleware";
import { json } from "@solidjs/router";

const SAFE_METHODS = ["GET", "HEAD", "OPTIONS", "TRACE"];
const TRUSTED_ORIGINS = ["https://another-app.com"];

export default createMiddleware({
  onRequest: (event) => {
    const { request } = event;

    if (!SAFE_METHODS.includes(request.method)) {
      const requestUrl = new URL(request.url);
      const origin = request.headers.get("Origin");

      // If we have an Origin header, check it against our allowlist.
      if (origin) {
        const parsedOrigin = new URL(origin);

        if (
          parsedOrigin.origin !== requestUrl.origin &&
          !TRUSTED_ORIGINS.includes(parsedOrigin.host)
        ) {
          return json({ error: "origin invalid" }, { status: 403 });
        }
      }

      // If we are serving via TLS and have no Origin header, prevent against
      // CSRF via HTTP man-in-the-middle attacks by enforcing strict Referer
      // origin checks.
      if (!origin && requestUrl.protocol === "https:") {
        const referer = request.headers.get("Referer");

        if (!referer) {
          return json({ error: "referer not supplied" }, { status: 403 });
        }

        const parsedReferer = new URL(referer);

        if (parsedReferer.protocol !== "https:") {
          return json({ error: "referer invalid" }, { status: 403 });
        }

        if (
          parsedReferer.host !== requestUrl.host &&
          !TRUSTED_ORIGINS.includes(parsedReferer.host)
        ) {
          return json({ error: "referer invalid" }, { status: 403 });
        }
      }
    }
  },
});
```

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªåŸºæœ¬çš„ CSRF é˜²æŠ¤æœºåˆ¶ï¼Œå®ƒä¼šéªŒè¯è¯·æ±‚çš„ Origin å’Œ Referer å¤´ï¼Œä»ä¸å¯ä¿¡çš„æ¥æºé˜»æ­¢è¯·æ±‚ã€‚æ­¤å¤–ï¼Œè¿˜åº”è€ƒè™‘å®ç°æ›´å¥å…¨çš„ CSRF é˜²æŠ¤æ–¹æ³•ï¼Œä¾‹å¦‚â€œåŒé‡æäº¤ Cookieï¼ˆDouble-Submit Cookieï¼‰â€æ¨¡å¼ã€‚

## æ•°æ®è·å–

SolidStart æ„å»ºåœ¨ Solid ä¹‹ä¸Šï¼Œå¹¶é»˜è®¤ä½¿ç”¨ Solid Routerã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ SolidStart ä¸­ä½¿ç”¨å®ƒä»¬å„è‡ªçš„æ•°æ®è·å–åŸè¯­ã€‚ç”±äº SolidStart æœ¬èº«æä¾›çš„æ•°æ®è·å– API éå¸¸æœ‰é™ï¼Œå¤§å¤šæ•°åŠŸèƒ½æ¥è‡ª Solid å’Œ Solid Routerã€‚

> æç¤ºï¼šæœ¬æŒ‡å—æä¾›äº†ä½¿ç”¨è¿™äº›åŸè¯­è¿›è¡Œå¸¸è§æ•°æ®è·å–ä»»åŠ¡çš„å®ç”¨ç¤ºä¾‹ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š

```tsx
// src/routes/index.tsx
import { For } from "solid-js";
import { query, createAsync } from "@solidjs/router";

const getPosts = query(async () => {
  const posts = await fetch("https://my-api.com/posts");
  return await posts.json();
}, "posts");

export default function Page() {
  const posts = createAsync(() => getPosts());
  return (
    <ul>
      <For each={posts()}>{(post) => <li>{post.title}</li>}</For>
    </ul>
  );
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæŸ¥è¯¢ã€‚ä¸ºäº†åœ¨ç»„ä»¶ä¸­è®¿é—®å…¶æ•°æ®ï¼Œä½¿ç”¨äº† createAsync åŸè¯­ã€‚

### æ˜¾ç¤ºåŠ è½½ç•Œé¢

è¦åœ¨æ•°æ®è·å–æœŸé—´å±•ç¤ºåŠ è½½ UIï¼š

- ä» solid-js å¯¼å…¥ Suspenseã€‚
- ä½¿ç”¨ \<Suspense> åŒ…è£¹æ•°æ®æ¸²æŸ“éƒ¨åˆ†ï¼Œå¹¶é€šè¿‡ fallback å±æ€§åœ¨æ•°æ®è·å–æ—¶æ˜¾ç¤ºä¸€ä¸ªç»„ä»¶ã€‚

```tsx
// src/routes/index.tsx
import { Suspense, For } from "solid-js";
import { query, createAsync } from "@solidjs/router";

const getPosts = query(async () => {
  const posts = await fetch("https://my-api.com/posts");
  return await posts.json();
}, "posts");

export default function Page() {
  const posts = createAsync(() => getPosts());
  return (
    <ul>
      <Suspense fallback={<div>Loading...</div>}>
        <For each={posts()}>{(post) => <li>{post.title}</li>}</For>
      </Suspense>
    </ul>
  );
}
```

### å¤„ç†é”™è¯¯

è¦åœ¨æ•°æ®è·å–å¤±è´¥æ—¶å±•ç¤ºå¤‡ç”¨ UIï¼š

- ä» solid-js å¯¼å…¥ ErrorBoundaryã€‚
- ä½¿ç”¨ \<ErrorBoundary> åŒ…è£¹æ•°æ®æ¸²æŸ“éƒ¨åˆ†ï¼Œå¹¶é€šè¿‡ fallback å±æ€§åœ¨å‘ç”Ÿé”™è¯¯æ—¶æ˜¾ç¤ºä¸€ä¸ªç»„ä»¶ã€‚

```tsx
// src/routes/index.tsx
import { ErrorBoundary, Suspense, For } from "solid-js";
import { query, createAsync } from "@solidjs/router";

const getPosts = query(async () => {
  const posts = await fetch("https://my-api.com/posts");
  return await posts.json();
}, "posts");

export default function Page() {
  const posts = createAsync(() => getPosts());
  return (
    <ul>
      <ErrorBoundary fallback={<div>Something went wrong!</div>}>
        <Suspense fallback={<div>Loading...</div>}>
          <For each={posts()}>{(post) => <li>{post.title}</li>}</For>
        </Suspense>
      </ErrorBoundary>
    </ul>
  );
}
```

### é¢„åŠ è½½æ•°æ®

åœ¨ç”¨æˆ·å¯¼èˆªæ—¶ï¼Œå¯ä»¥é€šè¿‡ **é¢„åŠ è½½æ•°æ®** æ¥ä¼˜åŒ–æ•°æ®è·å–ï¼š

- å¯¼å‡ºä¸€ä¸ªå¸¦æœ‰ preload å‡½æ•°çš„è·¯ç”±å¯¹è±¡ã€‚
- åœ¨ preload å‡½æ•°ä¸­è¿è¡Œä½ çš„æŸ¥è¯¢ã€‚
- åœ¨ç»„ä»¶ä¸­åƒå¾€å¸¸ä¸€æ ·ä½¿ç”¨è¯¥æŸ¥è¯¢ã€‚

```tsx
// src/routes/index.tsx
import { ErrorBoundary } from "solid-js";
import { query, createAsync, type RouteDefinition } from "@solidjs/router";

const getPosts = query(async () => {
  const posts = await fetch("https://my-api.com/posts");
  return await posts.json();
}, "posts");

export const route = {
  preload: () => getPosts(),
} satisfies RouteDefinition;

export default function Page() {
  const post = createAsync(() => getPosts());
  return (
    <div>
      <ErrorBoundary fallback={<div>Something went wrong!</div>}>
        <h1>{post().title}</h1>
      </ErrorBoundary>
    </div>
  );
}
```

### å‘æŸ¥è¯¢ä¼ é€’å‚æ•°

å½“åˆ›å»ºä¸€ä¸ªéœ€è¦å‚æ•°çš„æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥æŠŠæŸ¥è¯¢å‡½æ•°å®šä¹‰ä¸ºæ¥æ”¶ä»»æ„æ•°é‡çš„å‚æ•°ï¼š

```tsx
// src/routes/posts/[id]/index.tsx
import { ErrorBoundary } from "solid-js";
import { query, createAsync, type RouteDefinition } from "@solidjs/router";

const getPost = query(async (id: string) => {
  const post = await fetch(`https://my-api.com/posts/${id}`);
  return await post.json();
}, "post");

export const route = {
  preload: ({ params }) => getPost(params.id),
} satisfies RouteDefinition;

export default function Page() {
  const postId = 1;
  const post = createAsync(() => getPost(postId));
  return (
    <div>
      <ErrorBoundary fallback={<div>Something went wrong!</div>}>
        <h1>{post().title}</h1>
      </ErrorBoundary>
    </div>
  );
}
```

### ä½¿ç”¨æ•°æ®åº“æˆ– ORM

ä¸ºäº†åœ¨æŸ¥è¯¢ä¸­å®‰å…¨åœ°ä¸æ•°æ®åº“æˆ– ORM äº¤äº’ï¼Œéœ€è¦ç¡®ä¿å®ƒä»…åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œã€‚

æ–¹æ³•æ˜¯åœ¨æŸ¥è¯¢çš„ç¬¬ä¸€è¡ŒåŠ ä¸Š "use server"ï¼š

```tsx
// src/routes/index.tsx
import { For, ErrorBoundary } from "solid-js";
import { query, createAsync, type RouteDefinition } from "@solidjs/router";
import { db } from "~/lib/db";

const getPosts = query(async () => {
  "use server";
  return await db.from("posts").select();
}, "posts");

export const route = {
  preload: () => getPosts(),
} satisfies RouteDefinition;

export default function Page() {
  const posts = createAsync(() => getPosts());
  return (
    <ul>
      <ErrorBoundary fallback={<div>Something went wrong!</div>}>
        <For each={posts()}>{(post) => <li>{post.title}</li>}</For>
      </ErrorBoundary>
    </ul>
  );
}
```

### åœ¨å®¢æˆ·ç«¯è·å–æ•°æ®

å¦‚æœåªæƒ³åœ¨å®¢æˆ·ç«¯è·å–æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ **createResource** åŸè¯­ï¼š

```tsx
// src/routes/index.tsx
import { createResource, ErrorBoundary, Suspense, For } from "solid-js";

export default function Page() {
  const [posts] = createResource(async () => {
    const posts = await fetch("https://my-api.com/posts");
    return await posts.json();
  });
  return (
    <ul>
      <ErrorBoundary fallback={<div>Something went wrong!</div>}>
        <Suspense fallback={<div>Loading...</div>}>
          <For each={posts()}>{(post) => <li>{post.title}</li>}</For>
        </Suspense>
      </ErrorBoundary>
    </ul>
  );
}
```

## æ•°æ®å˜æ›´

æœ¬æŒ‡å—æä¾›äº†åœ¨ **SolidStart** ä¸­ä½¿ç”¨ **actions** è¿›è¡Œæ•°æ®å˜æ›´çš„å®ç”¨ç¤ºä¾‹ã€‚

### å¤„ç†è¡¨å•æäº¤

è¦ç”¨ action å¤„ç† \<form> çš„æäº¤ï¼š

1. ç¡®ä¿ action æœ‰å”¯ä¸€çš„åç§°ã€‚

2. å°† action é€šè¿‡ action å±æ€§ä¼ é€’ç»™ \<form> å…ƒç´ ã€‚

3. ç¡®ä¿ \<form> å…ƒç´ ä½¿ç”¨ post æ–¹æ³•æäº¤ã€‚

4. åœ¨ action ä¸­ä½¿ç”¨ **FormData** å¯¹è±¡ï¼Œé€šè¿‡å…¶åŸç”Ÿæ–¹æ³•æå–è¡¨å•å­—æ®µæ•°æ®ã€‚

```tsx
// src/routes/index.tsx
import { action } from "@solidjs/router";

const addPost = action(async (formData: FormData) => {
  const title = formData.get("title") as string;
  await fetch("https://my-api.com/posts", {
    method: "POST",
    body: JSON.stringify({ title }),
  });
}, "addPost");

export default function Page() {
  return (
    <form action={addPost} method="post">
      <input name="title" />
      <button>Add Post</button>
    </form>
  );
}
```

### ä¼ é€’é¢å¤–å‚æ•°

è¦ç»™ä½ çš„ **action** ä¼ é€’é¢å¤–çš„å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ **with** æ–¹æ³•ï¼š

```tsx
// src/routes/index.tsx
import { action } from "@solidjs/router";

const addPost = action(async (userId: number, formData: FormData) => {
  const title = formData.get("title") as string;
  await fetch("https://my-api.com/posts", {
    method: "POST",
    body: JSON.stringify({ userId, title }),
  });
}, "addPost");

export default function Page() {
  const userId = 1;
  return (
    <form action={addPost.with(userId)} method="post">
      <input name="title" />
      <button>Add Post</button>
    </form>
  );
}
```

### æ˜¾ç¤º Pending UI

è¦åœ¨ **action** æ‰§è¡Œè¿‡ç¨‹ä¸­å±•ç¤ºä¸€ä¸ª *pending* çŠ¶æ€çš„ UIï¼š

- ä» **@solidjs/router** å¯¼å…¥ useSubmissionã€‚
- ä½¿ç”¨ä½ çš„ **action** è°ƒç”¨ useSubmissionï¼Œå¹¶åˆ©ç”¨è¿”å›çš„ pending å±æ€§æ¥æ˜¾ç¤º *pending UI*ã€‚

```tsx
// src/routes/index.tsx
import { action, useSubmission } from "@solidjs/router";

const addPost = action(async (formData: FormData) => {
  const title = formData.get("title") as string;
  await fetch("https://my-api.com/posts", {
    method: "POST",
    body: JSON.stringify({ title }),
  });
}, "addPost");

export default function Page() {
  const submission = useSubmission(addPost);
  return (
    <form action={addPost} method="post">
      <input name="title" />
      <button disabled={submission.pending}>
        {submission.pending ? "Adding..." : "Add Post"}
      </button>
    </form>
  );
}
```

### å¤„ç†é”™è¯¯

è¦å¤„ç† **action** ä¸­å‘ç”Ÿçš„é”™è¯¯ï¼š

- ä» **@solidjs/router** å¯¼å…¥ useSubmissionã€‚
- ä½¿ç”¨ä½ çš„ **action** è°ƒç”¨ useSubmissionï¼Œå¹¶åˆ©ç”¨è¿”å›çš„ error å±æ€§æ¥å¤„ç†é”™è¯¯ã€‚

```tsx
// src/routes/index.tsx
import { Show } from "solid-js";
import { action, useSubmission } from "@solidjs/router";

const addPost = action(async (formData: FormData) => {
  const title = formData.get("title") as string;
  await fetch("https://my-api.com/posts", {
    method: "POST",
    body: JSON.stringify({ title }),
  });
}, "addPost");

export default function Page() {
  const submission = useSubmission(addPost);
  return (
    <form action={addPost} method="post">
      <Show when={submission.error}>
        <p>{submission.error.message}</p>
      </Show>
      <input name="title" />
      <button>Add Post</button>
    </form>
  );
}
```

### éªŒè¯è¡¨å•å­—æ®µ

è¦åœ¨ **action** ä¸­éªŒè¯è¡¨å•å­—æ®µï¼š

- åœ¨ä½ çš„ **action** ä¸­æ·»åŠ éªŒè¯é€»è¾‘ï¼Œå¦‚æœæ•°æ®æ— æ•ˆåˆ™è¿”å›éªŒè¯é”™è¯¯ã€‚
- ä» **@solidjs/router** å¯¼å…¥ useSubmissionã€‚
- ä½¿ç”¨ä½ çš„ **action** è°ƒç”¨ useSubmissionï¼Œå¹¶åˆ©ç”¨è¿”å›çš„ result å±æ€§æ¥å¤„ç†é”™è¯¯ã€‚

```tsx
// src/routes/index.tsx
import { Show } from "solid-js";
import { action, useSubmission } from "@solidjs/router";

const addPost = action(async (formData: FormData) => {
  const title = formData.get("title") as string;
  if (!title || title.length < 2) {
    return {
      error: "Title must be at least 2 characters",
    };
  }
  await fetch("https://my-api.com/posts", {
    method: "POST",
    body: JSON.stringify({ title }),
  });
}, "addPost");

export default function Page() {
  const submission = useSubmission(addPost);
  return (
    <form action={addPost} method="post">
      <input name="title" />
      <Show when={submission.result?.error}>
        <p>{submission.result?.error}</p>
      </Show>
      <button>Add Post</button>
    </form>
  );
}
```

### æ˜¾ç¤ºä¹è§‚ UI

åœ¨æœåŠ¡å™¨å“åº”å‰æ›´æ–°ç•Œé¢çš„æ–¹æ³•ï¼š

- ä» **@solidjs/router** å¯¼å…¥ useSubmissionã€‚
- ä½¿ç”¨ä½ çš„ **action** è°ƒç”¨ useSubmissionï¼Œå¹¶åˆ©ç”¨è¿”å›çš„ pending å’Œ input å±æ€§æ¥æ˜¾ç¤ºä¹è§‚ UIã€‚

```tsx
// src/routes/index.tsx
import { For, Show } from "solid-js";
import { action, useSubmission, query, createAsync } from "@solidjs/router";

const getPosts = query(async () => {
  const posts = await fetch("https://my-api.com/blog");
  return await posts.json();
}, "posts");

const addPost = action(async (formData: FormData) => {
  const title = formData.get("title");
  await fetch("https://my-api.com/posts", {
    method: "POST",
    body: JSON.stringify({ title }),
  });
}, "addPost");

export default function Page() {
  const posts = createAsync(() => getPosts());
  const submission = useSubmission(addPost);
  return (
    <main>
      <form action={addPost} method="post">
        <input name="title" />
        <button>Add Post</button>
      </form>
      <ul>
        <For each={posts()}>{(post) => <li>{post.title}</li>}</For>
        <Show when={submission.pending}>
          {submission.input?.[0]?.get("title")?.toString()}
        </Show>
      </ul>
    </main>
  );
}
```

> ğŸ“š **å¤šä¸ªæäº¤**
>
> å¦‚æœä½ å¸Œæœ›ä¸ºå¤šä¸ªå¹¶å‘æäº¤æ˜¾ç¤ºä¹è§‚ UIï¼Œå¯ä»¥ä½¿ç”¨ useSubmissions è¿™ä¸ªåŸè¯­ï¼ˆprimitiveï¼‰ã€‚

### é‡å®šå‘

åœ¨ action å†…é‡å®šå‘ç”¨æˆ·åˆ°å¦ä¸€ä¸ªè·¯ç”±ï¼š

1. ä» @solidjs/router å¯¼å…¥ redirectã€‚
2. ä½¿ç”¨ä½ å¸Œæœ›å¯¼èˆªåˆ°çš„è·¯ç”±è°ƒç”¨ redirectï¼Œå¹¶æŠ›å‡ºå…¶è¿”å›çš„å“åº”ã€‚

```tsx
// src/routes/index.tsx
import { action, redirect } from "@solidjs/router";

const addPost = action(async (formData: FormData) => {
  const title = formData.get("title") as string;
  const response = await fetch("https://my-api.com/posts", {
    method: "POST",
    body: JSON.stringify({ title }),
  });
  const post = await response.json();
  throw redirect(`/posts/${post.id}`);
}, "addPost");

export default function Page() {
  return (
    <form action={addPost} method="post">
      <input name="title" />
      <button>Add Post</button>
    </form>
  );
}
```

### ä½¿ç”¨æ•°æ®åº“æˆ– ORM

è¦åœ¨ action ä¸­å®‰å…¨åœ°ä¸æ•°æ®åº“æˆ– ORM äº¤äº’ï¼Œç¡®ä¿ä»£ç ä»…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå¯ä»¥åœ¨ action çš„ç¬¬ä¸€è¡Œæ·»åŠ  "use server"ï¼š

```tsx
// src/routes/index.tsx
import { action } from "@solidjs/router";
import { db } from "~/lib/db";

const addPost = action(async (formData: FormData) => {
  "use server";
  const title = formData.get("title") as string;
  await db.insert("posts").values({ title });
}, "addPost");

export default function Page() {
  return (
    <form action={addPost} method="post">
      <input name="title" />
      <button>Add Post</button>
    </form>
  );
}
```

### ä»¥ç¼–ç¨‹æ–¹å¼è°ƒç”¨ action

è¦ä»¥ç¼–ç¨‹æ–¹å¼è°ƒç”¨ actionï¼š

1. ä» @solidjs/router å¯¼å…¥ useActionã€‚
2. ä½¿ç”¨ useAction è°ƒç”¨ä½ çš„ actionï¼Œå¹¶ä½¿ç”¨è¿”å›çš„å‡½æ•°æ¥æ‰§è¡Œè¯¥ actionã€‚

```tsx
// src/routes/index.tsx
import { createSignal } from "solid-js";
import { action, useAction } from "@solidjs/router";

const addPost = action(async (title: string) => {
  await fetch("https://my-api.com/posts", {
    method: "POST",
    body: JSON.stringify({ title }),
  });
}, "addPost");

export default function Page() {
  const [title, setTitle] = createSignal("");
  const addPostAction = useAction(addPost);
  return (
    <div>
      <input value={title()} onInput={(e) => setTitle(e.target.value)} />
      <button onClick={() => addPostAction(title())}>Add Post</button>
    </div>
  );
}
```

## Service Workers

è¦æ³¨å†Œä¸€ä¸ª service workerï¼š

1. å°†ä½ çš„ service-worker æ–‡ä»¶æ”¾åœ¨ public ç›®å½•ä¸‹ï¼ˆä¾‹å¦‚ public/sw.jsï¼‰ï¼Œä½¿å…¶å¯ä»¥é€šè¿‡æ ¹ URL è®¿é—®ï¼ˆ/sw.jsï¼‰ã€‚
2. åœ¨ entry-client.tsx æ–‡ä»¶ä¸­æ·»åŠ æ³¨å†Œé€»è¾‘ã€‚

```tsx
// @refresh reload
import { mount, StartClient } from "@solidjs/start/client";

mount(() => <StartClient />, document.getElementById("app")!);

if ("serviceWorker" in navigator && import.meta.env.PROD) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/sw.js");
  });
}
```

